var Nn=Object.defineProperty;var _i=Object.getOwnPropertyDescriptor;var gi=Object.getOwnPropertyNames;var vi=Object.prototype.hasOwnProperty;var Si=(r,t)=>{for(var o in t)Nn(r,o,{get:t[o],enumerable:!0})},Ti=(r,t,o,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let u of gi(t))!vi.call(r,u)&&u!==o&&Nn(r,u,{get:()=>t[u],enumerable:!(i=_i(t,u))||i.enumerable});return r};var Ei=r=>Ti(Nn({},"__esModule",{value:!0}),r);var mc={};Si(mc,{VERSION:()=>Vn,compile:()=>Xt,createTag:()=>Je,customElement:()=>lt,default:()=>fc,tags:()=>qe});module.exports=Ei(mc);var xi="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";var Ai=(r=21)=>{let t="",o=r;for(;o--;)t+=xi[Math.random()*64|0];return t},qr=Ai;var Ge=class extends Error{constructor(t){super(t),this.name="i.js \u2764\uFE0F  brackets parse ERROR"}};function wi({open:r,close:t,pos:o,nodes:i},u,m){return{nodeType:"bracket",open:r,close:t,nodes:i,pos:Object.assign({},o,{end:u}),content:m.substring(o.start,u+1),innerContent:m.substring(o.start+1,u)}}function Ci(r){let t=new Map;return r.forEach(([o,i=o])=>t.set(o,i)),{quotes:t}}function Oi(r){let t={},o={};return r.forEach(([i,u])=>{o[i]=u,t[u]=i}),{opens:t,closes:o}}function Rn(r){let{text:t,parent:o,start:i,end:u,opt:m}=r;if(i===u&&!m.includeEmpty)return;let h=m.pairs.reduce((A,N)=>A.concat(N.split("")),[]).map(A=>`${m.escape}${A}`),_=A=>h.reduce((N,M)=>N.split(M).join(M[1]),A),E=o.pos.depth+1;o.nodes.push({nodeType:"text",pos:{start:i,end:u,depth:E},content:_(t.substring(i,u))})}var Bn=r=>{let t=r.pop();if(t===void 0)throw new Ge("LogicError :)");return t};function rt(r,t){let i=Object.assign({pairs:["()","{}","[]"],nestMax:100,escape:"\\",skip:!1,includeEmpty:!1,quotes:['"',"'","`"]},t||{}),{pairs:u,nestMax:m,escape:h,skip:_}=i,{opens:E,closes:A}=Oi(u),{quotes:N}=Ci(i.quotes),M=[{nodeType:"root",nodes:[],pos:{start:0,end:0,depth:-1},content:r}],j=0,te=null,I=0;for(let ne=0;ne<r.length;ne++){let re=Bn(M),V=r[ne],d=ne>0&&r[ne-1]===h;if(_&&["{","}","(",")","[","]"].includes(V)&&re.nodeType==="root")M.push(re);else if(_&&["{","(","["].includes(re.open)&&(V==="<"||V===">"))M.push(re);else if(d)M.push(re);else if(te!==null)te===V&&(te=null),M.push(re);else if(N.has(V))te=N.get(V),I=ne,M.push(re);else if(A[V]!==void 0){if(M.length>=m)throw new Ge(`over nest max limit. options: { nestMax: '${i.nestMax}' }`);Rn({text:r,parent:re,start:j,end:ne,opt:i}),M.push(re),M.push({nodeType:"bracket-open",pos:{start:ne,depth:re.pos.depth+1},open:V,close:A[V],nodes:[]}),j=ne+1}else if(E[V]!==void 0){if(re.nodeType==="root"||E[V]!==re.open)throw new Ge(`404 pair '${E[V]}' :${ne}`);let be=Bn(M);Rn({text:r,parent:re,start:j,end:ne,opt:i});let Oe=wi(re,ne,r);be.nodes.push(Oe),M.push(be),j=ne+1}else M.push(re)}if(te!==null)throw new Ge(`unclosed quote ${te} near "...${r.substring(j-20,j+30)}..."`);let ve=Bn(M);if(ve.nodeType!=="root")throw new Ge(`404 pair '${ve.open}' :${ve.pos.start}`);return Rn({text:r,parent:ve,start:j,end:r.length,opt:i}),ve.nodes}function Jr(r){return[...r].reduce((t,o)=>(t.quote?(o===t.quote&&(t.quote=void 0),t.a[t.a.length-1]+=o):o==="="?t.a[t.a.length-1].length?t.a.push("="):t.a[t.a.length-1]="=":o===" "?t.a[t.a.length-1]!=="="&&t.a[t.a.length-1].length&&t.a.push(""):(['"',"'","`"].includes(o)&&(t.quote=o),t.a[t.a.length-1]+=o),t),{a:[""]}).a}function _t(r,t="|",o=!1){let i=[...r].reduce((u,m)=>(u.quote?(m===u.quote&&(u.quote=void 0),u.a[u.a.length-1]+=m):m===t?u.a.push(""):(['"',"'","`"].includes(m)&&(u.quote=m),u.a[u.a.length-1]+=m),u),{a:[""]}).a;return o?i.filter(u=>u):i}function Vr(r,t="|"){var o=r.lastIndexOf(t);return[r.substr(0,o),r.substr(o+1)]}function $i(r){if(['"',"'","`"].includes(r[0])&&r[0]===r[r.length-1]){for(var t=1;t<r.length-1;){if(r[t]===r[0]&&r[t-1]!=="\\")return!1;t++}return!0}return!1}function Li(r){return r.filter(t=>t.opts&&t.opts.length).forEach(t=>{t.opts2={};let o=t.opts.find(_=>_.type==="loop");if(o){let _=o.key;t.opts2.key=new Function(`return ${_}`)();let E=o.value.split(" as ");if(!E[1])throw"\u041D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D \u0430\u043B\u0438\u0430\u0441 \u0434\u043B\u044F loop";let A=E[1].split(",");t.opts2.loop_fn=E[0].trim(),t.opts2.loop_alias=A[0].trim(),A[1]&&(t.opts2.loop_key_alias=A[1].trim())}let i=t.opts.find(_=>_.type==="text");i&&($i(i.value)?t.opts2.text=i.value.substring(1,i.value.length-1):t.opts2.textFn=i.value),["if","style","attrs","enterStyles","updateStyles","exitStyles","enterAttrs","updateAttrs","exitAttrs"].forEach(_=>{let E=t.opts.find(A=>A.type===_);E&&(t.opts2[_]=E.value)}),t.opts.filter(_=>_.type==="eventCallback").forEach(_=>{t.opts2.events||(t.opts2.events={});let E=_.key.substr(1);if(t.opts2.events[E])throw`i.js compile error: Duplicate event name "${E}"`;_.value=_.value.substring(1,_.value.length-1).trim(),_.value[0]==="{"?_.value="{setTimeout(()=>this.render(),0);"+_.value.substring(1):_.value="setTimeout(()=>this.render(),0) && ("+_.value+")",t.opts2.events[E]=_.value}),t.opts.filter(_=>_.type==="eventBind"||_.type==="eventBindSelfNamed").forEach(_=>{t.opts2.events||(t.opts2.events={});let E=_.key.substr(1);if(t.opts2.events[E])throw`i.js compile error: Duplicate event name "${E}"`;t.opts2.events[E]=new Function(`return (...args) => this.${_.value}(...args)`)()}),t.opts.filter(_=>_.type==="eventCallFunction").forEach(_=>{t.opts2.events||(t.opts2.events={});let E=_.key.substr(1);if(t.opts2.events[E])throw`i.js compile error: Duplicate event name "${E}"`;t.opts2.events[E]=`${_.value}${_.args}`})}),r.filter(t=>t.opts&&t.opts.length).forEach(t=>{t.opts2||(t.opts2={}),t.opts2.attrs2||(t.opts2.attrs2={},t.opts2.attrsB={}),t.opts.filter(m=>m.type==="booleanAttribute").forEach(m=>{t.opts2.attrs2[m.key]&&console.warn(`i.js compile warning: direct attibute "${m.key}" override attrs({...${m.key}...}) declaration in tag ""!`),t.opts2.attrs2[m.key]=m.key,t.opts2.attrsB[m.key]=!0}),t.opts.filter(m=>m.type==="stringAttribute").forEach(m=>{t.opts2.attrs2[m.key]&&console.warn(`i.js compile warning: direct attibute "${m.key}" override attrs({...${m.key}...}) declaration in tag ""!`),t.opts2.attrs2[m.key]=m.value}),t.opts.filter(m=>m.type==="jsAttribute").forEach(m=>{t.opts2.attrs2[m.key]&&console.warn(`i.js compile warning: direct attibute "${m.key}" override attrs({...${m.key}...}) declaration in tag ""!`),t.opts2.attrs2[m.key]=m.value.endsWith("%")?m.value:m})}),r.forEach(t=>{t.opts2&&t.opts2.attrs2&&!Object.keys(t.opts2.attrs2).length&&(delete t.opts2.attrs2,delete t.opts2.attrsB),t.opts2&&t.opts2.events&&!Object.keys(t.opts2.events).length&&delete t.opts2.events}),r}function Ie({AAA:r,item:t,tag:o,a:i},u="enter",m="enterStyles"){if(i===u&&r.length){let h=r.shift().content;if(h[0]==="("){if(t.opts.find(_=>_.type===u))throw`i.js template parse error: duplicate ${u}() inside "<${o}>" declaration`;t.opts.push({type:m,value:h.slice(1,-1)})}else throw`i.js template parse error: expected "${u}(..." but "${u}${h[0]}..." found inside "<${o}>"`;return!0}return!1}function Wr(r){return r.filter(t=>t.nodeType==="bracket"&&t.innerContent[0]!=="/").forEach(t=>{t.opts=[];let o=rt(t.innerContent).map(u=>({nodeType:u.nodeType,content:u.content.trim()}));var i="";do{let u=o.shift();if(u.nodeType==="bracket")throw`i.js template parse error: unxpected brackets "${u.content}" at the end of <${i}> attributes`;if(u.nodeType==="text"){let m=Jr(u.content);i||(i=m.shift());do{let h=m.shift();if(m[0]&&m[0][0]==="="){let _=m.shift().substr(1);if(h[0]==="@"){if(['"',"'","`"].includes(_[0]))throw`i.js template parse error: quotes around ${_} is prohibited`;if(o.length&&o[0].nodeType==="bracket"){let E=o.shift();t.opts.push({type:"eventCallFunction",key:h,value:_,args:E.content})}else t.opts.push({type:"eventBind",key:h,value:_.endsWith("/")?_.substring(0,_.length-1):_})}else if(_.startsWith('"')&&_.endsWith('"')||_.startsWith("`")&&_.endsWith("`")||_.startsWith("'")&&_.endsWith("'"))t.opts.push({type:"stringAttribute",key:h,value:_.slice(1,-1)});else if(_.length)t.opts.push({type:"jsAttribute",key:h,value:_.endsWith("/")?_.substring(0,_.length-1):_});else{if(!o.length)throw`i.js template parse error: unxpected end of attribute "...${h}=" inside "<${i}>" declaration`;let E=o.shift().content;E[0]==="{"?t.opts.push({type:"eueAttribute",key:h,value:E}):E[0]==="["?t.opts.push({type:"transitionAttribute",key:h,value:E}):t.opts.push({type:"jsAttribute",key:h,value:E.substring(1,E.length-1)})}}else if(h==="loop"&&o.length){let _=o.shift().content;if(_[0]==="("){if(t.opts.find(N=>N.type==="loop"))throw`i.js template parse error: duplicate loop${_} inside "<${i}>" declaration`;let[E,A]=Vr(_.slice(1,-1));if(A)t.opts.push({type:"loop",key:A,value:E});else throw`i.js template parse error: non-keyed loop not supported yet. "loop${_}" inside "<${i}>"`}else throw`i.js template parse error: expected "loop(..." but "loop${_[0]}..." found inside "<${i}>" `}else if(!Ie({AAA:o,item:t,tag:i,a:h},"if","if")){if(!Ie({AAA:o,item:t,tag:i,a:h},"style","style")){if(!Ie({AAA:o,item:t,tag:i,a:h},"attrs","attrs")){if(!Ie({AAA:o,item:t,tag:i,a:h},"enter","enterStyles")){if(!Ie({AAA:o,item:t,tag:i,a:h},"update","updateStyles")){if(!Ie({AAA:o,item:t,tag:i,a:h},"exit","exitStyles")){if(!Ie({AAA:o,item:t,tag:i,a:h},"#enter","enterAttrs")){if(!Ie({AAA:o,item:t,tag:i,a:h},"#update","updateAttrs")){if(!Ie({AAA:o,item:t,tag:i,a:h},"#exit","exitAttrs")){if(h==="text"&&o.length){let _=o.shift().content;if(_[0]==="("){if(t.opts.find(E=>E.type==="text"))throw`i.js template parse error: duplicate text{c} inside "<${i}>" declaration`;t.opts.push({type:"text",value:_.slice(1,-1)})}else throw`i.js template parse error: expected "text(..." but "text{c[0]}..." found inside "<${i}>"`}else if(h)if(h[0]==="@")if(!m.length&&o[0]&&o[0].nodeType==="bracket"){let _=o.shift();t.opts.push({type:"eventCallback",key:h,value:_.content})}else t.opts.push({type:"eventBindSelfNamed",key:h,value:h.slice(1)});else{if(h==="=")throw`i.js template parse error: unxpected end of attribute "${h}" inside "<${i}>" declaration`;h!=="/"&&t.opts.push({type:"booleanAttribute",key:h})}}}}}}}}}}}while(m.length)}}while(o.length)}),Li(r)}var kn={"!DOCTYPE":!0,"!doctype":!0,area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,menuitem:!0,param:!0,source:!0,track:!0,wbr:!0,circle:!0,ellipse:!0,line:!0,path:!0,polygon:!0,polyline:!0,rect:!0,stop:!0,use:!0};var qt=class extends Error{constructor(t){super(t),this.name="i.js \u2764\uFE0F  syntax ERROR"}};function Mn(r,t=[]){if(!t.length)return r;if(r[0]=="@"){if(r.length===1)throw"empty alias tag <@>";let o=t.find(i=>i.alias===r);if(o)r=o.name;else throw`alias <${r}> not defined`}return r}function Fn(r,t){let o=t.find(i=>i.name===r);return o?o.alias:r}function Pi(r,t){let o=[{children:[]}];if(o.last=()=>o[o.length-1],r.forEach(i=>{if(i.nodeType==="text"){var u=o[o.length-1];if(u.text)throw"children and text() attribute at the same time";u.children.push({tag:"#text",content:i.content})}else{var m=i.content.match(new RegExp("^<(@?[a-z][-a-z0-9]*)(\\s.*)?\\/>$","s"));if(m){var u=o[o.length-1];if(u.text)throw"children and text() attribute at the same time";u.children.push(Object.assign({tag:Mn(m[1],t)},i.opts2))}else{var h=i.content.match(new RegExp("^<(@?[a-z][-a-z0-9]*)(\\s.*)?>$","s"));if(h)if(kn[h[1]]){let E=o[o.length-1];if(E.text)throw"children and text() attribute at the same time";E.children.push(Object.assign({tag:Mn(h[1],t)},i.opts2))}else o.push(Object.assign({tag:Mn(h[1],t),children:[]},i.opts2));else{var _=i.content.match(new RegExp("^<\\/(@?[a-z][-a-z0-9]*)(\\s.*)?>$","s"));if(_){if(kn[_[1]])throw`can't close self-closing tag "</${_[1]}>"`;let E=o[o.length-2],A=o.pop();if(A.children.length===1&&A.children[0].tag==="#text"?(A.text=A.children[0].content,delete A.children):A.children.length||delete A.children,E){if(E.text)throw"children and text() attribute at the same time";let N=Fn(A.tag,t),M=Fn(_[1],t);if(N!==M)throw`the opening and closing tags are not the same <${N}>...</${M}>`;E.children.push(A)}else throw!A.children||A.children[0].tag!==_[1]?`missing the opening tag for </${_[1]}>`:`closed twice tag <${A.children[0].tag}>`}}}}}),o.length>1){let i=o.find(u=>u.tag);throw`Unclosed tag <${Fn(i.tag,t)}>`}return o[0].children}var Qr=Pi;var st={};st.animate=function(r,t,o,i,u,m){if(typeof r!="number"||typeof t!="number"||typeof o!="number"||typeof i!="function")return;typeof u=="string"&&H[u]&&(u=H[u]),typeof u!="function"&&(u=H.linear),typeof m!="function"&&(m=function(){});var h=window.requestAnimationFrame||function(M){window.setTimeout(M,1e3/60)},_=!1,E=t-r;function A(M){if(!_){var j=(M||+new Date)-N;j>=0&&i(u(j,r,E,o)),j>=0&&j>=o?(i(t),m()):h(A)}}i(r);var N=window.performance&&window.performance.now?window.performance.now():+new Date;return h(A),{cancel:function(){_=!0}}};st.animateCSS=function(r,t,o,i,u,m,h,_){var E=function(A){r.style[t]=A+o};return st.animate(i,u,m,E,h,_)};st.cancel=function(r){r&&r.cancel()};var H=st.easings={};H.linear=function(r,t,o,i){return o*r/i+t};H.easeInQuad=function(r,t,o,i){return o*(r/=i)*r+t};H.easeOutQuad=function(r,t,o,i){return-o*(r/=i)*(r-2)+t};H.easeInOutQuad=function(r,t,o,i){return(r/=i/2)<1?o/2*r*r+t:-o/2*(--r*(r-2)-1)+t};H.easeInCubic=function(r,t,o,i){return o*(r/=i)*r*r+t};H.easeOutCubic=function(r,t,o,i){return o*((r=r/i-1)*r*r+1)+t};H.easeInOutCubic=function(r,t,o,i){return(r/=i/2)<1?o/2*r*r*r+t:o/2*((r-=2)*r*r+2)+t};H.easeInQuart=function(r,t,o,i){return o*(r/=i)*r*r*r+t};H.easeOutQuart=function(r,t,o,i){return-o*((r=r/i-1)*r*r*r-1)+t};H.easeInOutQuart=function(r,t,o,i){return(r/=i/2)<1?o/2*r*r*r*r+t:-o/2*((r-=2)*r*r*r-2)+t};H.easeInQuint=function(r,t,o,i){return o*(r/=i)*r*r*r*r+t};H.easeOutQuint=function(r,t,o,i){return o*((r=r/i-1)*r*r*r*r+1)+t};H.easeInOutQuint=function(r,t,o,i){return(r/=i/2)<1?o/2*r*r*r*r*r+t:o/2*((r-=2)*r*r*r*r+2)+t};H.easeInSine=function(r,t,o,i){return-o*Math.cos(r/i*(Math.PI/2))+o+t};H.easeOutSine=function(r,t,o,i){return o*Math.sin(r/i*(Math.PI/2))+t};H.easeInOutSine=function(r,t,o,i){return-o/2*(Math.cos(Math.PI*r/i)-1)+t};H.easeInExpo=function(r,t,o,i){return r==0?t:o*Math.pow(2,10*(r/i-1))+t};H.easeOutExpo=function(r,t,o,i){return r==i?t+o:o*(-Math.pow(2,-10*r/i)+1)+t};H.easeInOutExpo=function(r,t,o,i){return r==0?t:r==i?t+o:(r/=i/2)<1?o/2*Math.pow(2,10*(r-1))+t:o/2*(-Math.pow(2,-10*--r)+2)+t};H.easeInCirc=function(r,t,o,i){return-o*(Math.sqrt(1-(r/=i)*r)-1)+t};H.easeOutCirc=function(r,t,o,i){return o*Math.sqrt(1-(r=r/i-1)*r)+t};H.easeInOutCirc=function(r,t,o,i){return(r/=i/2)<1?-o/2*(Math.sqrt(1-r*r)-1)+t:o/2*(Math.sqrt(1-(r-=2)*r)+1)+t};H.easeInElastic=function(r,t,o,i){var u=0,m=o;if(r==0)return t;if((r/=i)==1)return t+o;if(u||(u=i*.3),m<Math.abs(o)){m=o;var h=u/4}else var h=u/(2*Math.PI)*Math.asin(o/m);return-(m*Math.pow(2,10*(r-=1))*Math.sin((r*i-h)*(2*Math.PI)/u))+t};H.easeOutElastic=function(r,t,o,i){var u=0,m=o;if(r==0)return t;if((r/=i)==1)return t+o;if(u||(u=i*.3),m<Math.abs(o)){m=o;var h=u/4}else var h=u/(2*Math.PI)*Math.asin(o/m);return m*Math.pow(2,-10*r)*Math.sin((r*i-h)*(2*Math.PI)/u)+o+t};H.easeInOutElastic=function(r,t,o,i){var u=0,m=o;if(r==0)return t;if((r/=i/2)==2)return t+o;if(u||(u=i*(.3*1.5)),m<Math.abs(o)){m=o;var h=u/4}else var h=u/(2*Math.PI)*Math.asin(o/m);return r<1?-.5*(m*Math.pow(2,10*(r-=1))*Math.sin((r*i-h)*(2*Math.PI)/u))+t:m*Math.pow(2,-10*(r-=1))*Math.sin((r*i-h)*(2*Math.PI)/u)*.5+o+t};H.easeInBack=function(r,t,o,i,u){return u==null&&(u=1.70158),o*(r/=i)*r*((u+1)*r-u)+t};H.easeOutBack=function(r,t,o,i,u){return u==null&&(u=1.70158),o*((r=r/i-1)*r*((u+1)*r+u)+1)+t};H.easeInOutBack=function(r,t,o,i,u){return u==null&&(u=1.70158),(r/=i/2)<1?o/2*(r*r*(((u*=1.525)+1)*r-u))+t:o/2*((r-=2)*r*(((u*=1.525)+1)*r+u)+2)+t};H.easeInBounce=function(r,t,o,i){return o-H.easeOutBounce(i-r,0,o,i)+t};H.easeOutBounce=function(r,t,o,i){return(r/=i)<1/2.75?o*(7.5625*r*r)+t:r<2/2.75?o*(7.5625*(r-=1.5/2.75)*r+.75)+t:r<2.5/2.75?o*(7.5625*(r-=2.25/2.75)*r+.9375)+t:o*(7.5625*(r-=2.625/2.75)*r+.984375)+t};H.easeInOutBounce=function(r,t,o,i){return r<i/2?H.easeInBounce(r*2,0,o,i)*.5+t:H.easeOutBounce(r*2-i,0,o,i)*.5+o*.5+t};var gt=st;var Ne={duration:500};function Dn(r,t,o){var i=r[t];if(t<o)for(;t<o;t++)r[t]=r[t+1];else for(;t>o;t--)r[t]=r[t-1];r[o]=i}function ot(r){if(r.svg)var t=document.createElementNS("http://www.w3.org/2000/svg",r.tag);else var t=document.createElement(r.tag);return Object.assign(t,{_attrs:{},_styles:{},_attrsV:{},_styleV:{},_colors:{}}),t}var Kr=r=>`
    var element = document.createElement("${r}");
    Object.assign(element, {_attrs:{},_styles:{},_attrsV:{},_styleV:{}, _colors:{}});
`,Hr=r=>`
    var element = document.createElementNS("http://www.w3.org/2000/svg", "${r}");
    Object.assign(element, {_attrs:{},_styles:{},_attrsV:{},_styleV:{}, _colors:{}});
`;function at(r,t,o){var i="linear";if(typeof o=="object"){var u=o.duration||Ne.duration,m=o.to;o.ease&&(i=o.ease)}else var u=Ne.duration,m=o;var h=r.getAttribute(t)?Number(r.getAttribute(t)):0;gt.cancel(r._attrs[t]),r._attrs[t]=gt.animate(h,m,u,_=>{r.setAttribute(t,_)},i)}function Ii(r,t,o){var i="linear",u=0;if(typeof o=="object"){var m=o.duration||Ne.duration,h=o.to;o.ease&&(i=o.ease),o.delay&&(u=o.delay)}else var m=Ne.duration,h=o;r._colors[t]={key:t,duration:m,ease:i,delay:u},setTimeout(()=>{delete r._colors[t];var E=Object.values(r._colors).map(A=>A.key+" "+A.duration+"ms "+A.ease+" "+A.delay+"ms").join(",");r.style.setProperty("transition",E||"none")},m+u);var _=Object.values(r._colors).map(E=>E.key+" "+E.duration+"ms "+E.ease+" "+E.delay+"ms").join(",");r.style.setProperty("transition",_||"none"),r.style.getPropertyValue(t)||r.style.setProperty(t,"#000000"),setTimeout(()=>{r.style.setProperty(t,h)},0)}function Jt(r,t,o){if(["color","background","fill","stroke","background-color","border-color"].includes(t)){Ii(r,t,o);return}var i="linear",u=0;if(typeof o=="object"){var m=o.duration||Ne.duration,h=o.to;o.from&&(u=o.from),o.ease&&(i=o.ease)}else var m=Ne.duration,h=o;var _=r.style[t],E="";typeof h=="string"&&(h.endsWith("px")?(u=Number(_.substring(0,_.length-2)),h=Number(h.substring(0,h.length-2)),E="px"):h.endsWith("%")&&(u=Number(_.substring(0,_.length-1)),h=Number(h.substring(0,h.length-1)),E="%")),gt.cancel(r._styles[t]),r._styles[t]=gt.animate(u,h,m,A=>{r.style.setProperty(t,A+E)},i)}function vt(r,t){return!!(r==="input"&&["checked","autofocus","readonly","required","disabled","multiple"].includes(t)||r==="option"&&["selected"].includes(t)||r==="button"&&["disabled","multiple"].includes(t))}function Xr(r,t,o,i,u){var m=u;return at(r,i,m),typeof m=="object"&&m.duration?m.duration:Ne.duration;return 0}function Zr(r,t,o,i,u){var m=u;return Jt(r,i,m),typeof m=="object"&&m.duration?m.duration:Ne.duration;return 0}function es(r,t,o,i,u,m){var h=0,_=0;if(t.exitAttrs){var E=t.exitAttrs(o);typeof E=="object"&&(_=Object.entries(E).reduce((N,M)=>Math.max(Xr(r,t,o,M[0],M[1]),N),0))}if(t.exitStyles){var A=t.exitStyles(o);typeof A=="object"&&(h=Object.entries(A).reduce((N,M)=>Math.max(Zr(r,t,o,M[0],M[1]),N),0))}if(h>0||_>0){let N=setTimeout(()=>m.Done.then(()=>{r.remove(),u.exit.delete(i)}),h>_?h:_);u.exit.set(i,{element:r,timeout:N});return}r.remove()}function ts(r,t,o,i,u){var m=0,h=0;if(t.exitAttrs){var _=t.exitAttrs(o);typeof _=="object"&&(h=Object.entries(_).reduce((A,N)=>Math.max(Xr(r,t,o,N[0],N[1]),A),0))}if(t.exitStyles){var E=t.exitStyles(o);typeof E=="object"&&(m=Object.entries(E).reduce((A,N)=>Math.max(Zr(r,t,o,N[0],N[1]),A),0))}if(m>0||h>0){let A=setTimeout(()=>i.Done.then(()=>{r.remove(),i.__i__[u]=!1}),m>h?m:h);return i.__i__[u]={exit:A},!1}return i.__i__[u]=!1,r.remove(),!0}function St(r,t,o,i,u,m,h){var _=u.keys,E=u.elements,A=u.exit,N=E.length,M=h.length,j=N>M?N:M,te=0,I=0,ve=0;do{if(I<M){var ne=r.key(h[I]);if(I>=N){N++,j=N>M?N:M;var re=A.get(ne);if(re){clearTimeout(re.timeout);var V=re.element;A.delete(ne)}else var V=ot(r);if(i[r.loop_alias]=h[I],r.loop_key_alias&&(i[r.loop_key_alias]=I),Un(V,r,i,he),I===0)if(A.size)for(let Fe of A){Fe[1].element.before(V);break}else o?o.after(V):t.prepend(V);else E[I-1].after(V);E.splice(I,0,V),V.key=ne,_[ne]=!0,I++;continue}else{var d=E[I].key;if(ne===d){i[r.loop_alias]=h[I],r.loop_key_alias&&(i[r.loop_key_alias]=I),r.Update_Tag(E[I],r,i,he),I++;continue}else if(_[ne]){var be=void 0,Oe=void 0;let Fe;for(var ye=I+1;ye<j;ye++)if(!be&&ye<N&&E[ye].key===ne&&(be=ye+1),!Oe&&ye<M&&r.key(h[ye])===d&&(Oe=ye+1),be&&Oe){var ut=E[I];if(be>=Oe)Fe=E[be-1],t.insertBefore(Fe,ut),i[r.loop_alias]=h[I],r.loop_key_alias&&(i[r.loop_key_alias]=I),r.Update_Tag(Fe,r,i,he),be===Oe?(ye-I>1&&t.insertBefore(ut,E[be]),E[I]=E[ye],E[ye]=ut):(Dn(E,be-1,I),te++),I++;else{var pt=Oe-1+te;t.insertBefore(ut,E[pt]||null),Dn(E,I,(pt>N?N:pt)-1),te--,i[r.loop_alias]=h[I],r.loop_key_alias&&(i[r.loop_key_alias]=I),r.Update_Tag(E[I],r,i,he)}break}if(Fe)continue}else{N++,j=N>M?N:M;var re=A.get(ne);if(re)clearTimeout(re.timeout),V=re.element,A.delete(ne);else var V=ot(r);i[r.loop_alias]=h[I],r.loop_key_alias&&(i[r.loop_key_alias]=I),Un(V,r,i,he),I===0?o?o.after(V):t.prepend(V):E[I-1].after(V),E.splice(I,0,V),V.key=ne,_[ne]=!0,I++;continue}}}delete _[E[I].key],r.loop_key_alias&&(i[r.loop_key_alias]=I+ve,ve++),es(E[I],r,i,E[I].key,u,t),E.splice(I,1),N--,j=N>M?N:M}while(I<j);return u.length=E.length,A.size+u.length}function Ni(){return{ret_element:function(r,t,o,i){return r},children:function(r,t,o,i){i.UPDATE_Chidldren(r,t.children,o)},fn_text:function(r,t,o,i){var u=t.text(o);r.__lastText!==u&&(r.textContent=r.__lastText=u)},updateProps:function(r,t,o,i){t.updateProps(r,t,o,i)}}}function Vt(r){var t=[],o=Ni();return r.tag==="#text"?(t.push(o.ret_element),t):(r.children?t.push(o.children):typeof r.text=="function"&&t.push(o.fn_text),r.updateProps&&(t=[...t,...r.updateProps]),t.push(o.ret_element),t)}function Ri(r,t,o,i,u,m){return t.Update_Tag(r.childNodes[u],t,o,he),u+1}function Bi(r,t,o,i,u,m){let h=t.loop(o);if(!m||m.length===0){if(!m||m.exit.size===0)return h.length?i===0?(t.enter(t,r,void 0,o,i,h,he),u+r.__i__[i].length):(t.enter(t,r,u===0?void 0:r.childNodes[u-1],o,i,h,he),u+r.__i__[i].length):u;if(h.length){let _=St(t,r,i===0||u===0?void 0:r.childNodes[u],o,m,i,h);return u+_}else return u+m.exit.size}else if(h.length){let _=St(t,r,i===0||u===0?void 0:r.childNodes[u-1],o,m,i,h);return u+_}else{let _=St(t,r,i===0||u===0?void 0:r.childNodes[u],o,m,i,h);return u+_}}function ki(r,t,o,i,u,m){if(m===!1)if(t.if(o)){let _=ot(t);if(t.children)Ye(_,t.children,o);else{var h=typeof t.text=="function"?t.text(o):t.text;_.__lastText!==h&&(_.textContent=_.__lastText=h)}return t.enterProps&&t.enterProps(_,t,o,he),u===0?r.prepend(_):r.childNodes[u-1].after(_),r.__i__[i]={exit:!1},u+1}else return u;else return t.if(o)?m.exit?(clearTimeout(m.exit),t.enterProps&&t.enterProps(r.childNodes[u],t,o,he),r.__i__[i]={exit:!1},u+1):(typeof t.text!="string"&&t.Update_Tag(r.childNodes[u],t,o,he),u+1):m.exit?u+1:ts(r.childNodes[u],t,o,r,i)?u:u+1}function Mi(r,t,o,i,u,m){if(m===!1||m.length===0)if(t.if(o)){let h=t.loop(o);return h.length?i===0?(t.enter(t,r,void 0,o,i,h,he),u+r.__i__[i].length):(t.enter(t,r,u===0?void 0:r.childNodes[u-1],o,i,h,he),u+r.__i__[i].length):u}else return u;else if(t.if(o)){let h=t.loop(o),_=St(t,r,i===0&&u===0?void 0:r.childNodes[u],o,m,i,h);return u+_}else{if(m.length===0)return u+m.exit.size;{let h=St(t,r,i===0&&u===0?void 0:r.childNodes[u],o,m,i,[]);return u+h}}}function Tt(r,t,o){var i=void 0;r.Done=new Promise(m=>i=m);var u=0;t.forEach((m,h)=>{let _=r.__i__[h];if(m.tag==="#text"){u++;return}m.hasOwnProperty("if")?m.loop?u=Mi(r,m,o,h,u,_):u=ki(r,m,o,h,u,_):m.loop?u=Bi(r,m,o,h,u,_):u=Ri(r,m,o,h,u,_)}),i()}function ns(r,t,o,i){if(o==="class"){if(typeof i=="object")throw"Cannot do transition on  class attribute";var u=i||void 0;t._attrsV[o]!==u&&(t._attrsV[o]=u,u?r.svg?t.setAttribute(o,u):t.className=u:t.removeAttribute(o))}else if(t._attrsV[o]!==i)if(t._attrsV[o]=i,vt(r.tag,o)){if(typeof i=="object")throw"Cannot do transition on boolean attribute";t._attrsV[o]=i,i?t.setAttribute(o,"")||(t[o]=o):t.removeAttribute(o)||(t[o]="")}else typeof i=="object"?at(t,o,i):t.setAttribute(o,i)}function Fi(){return{updateAttrs:function(r,t,o,i){Object.entries(t.updateAttrs(o)).forEach(([u,m])=>{i.updateAttribute(t,r,u,m)})},attrs3:function(r,t,o,i){Object.entries(t.attrs3).forEach(([u,m])=>{i.updateAttribute(t,r,u,typeof m=="function"?m(o):m)})},updateStyles:function(r,t,o,i){Object.entries(t.updateStyles(o)).forEach(([u,m])=>{typeof m=="object"?i.animateCSS(r,u,m):r.style.setProperty(u,m)})}}}function Wt(r){let t=[],o=Fi();return r.updateAttrs&&t.push(o.updateAttrs),r.attrs3&&t.push(o.attrs3),r.updateStyles&&t.push(o.updateStyles),t}var rs=(...r)=>r.filter(t=>typeof t=="function").reduce((t,o)=>t===null?o:function(...u){t.apply(this,u),o.apply(this,u)},null);var Di={createElementHTML:Kr,createElementSVG:Hr,createElement:ot,Enter_Children:Ye,UPDATE_Chidldren:Tt,Update_Tag:Vt,animateAttr:at,animateCSS:Jt,enterProps:Qt,enterAttribute:ss,updateProps:Wt,updateAttribute:ns},he=Di;function ss(r,t,o,i){if(o==="class"){var u=i||void 0;t._attrsV[o]=u,u&&(t._attrsV[o]=u,r.svg?t.setAttribute(o,u):t.className=u)}else vt(r.tag,o)?(t._attrsV[o]=i&&!0,i&&t.setAttribute(o,"")):(t._attrsV[o]=i,t.setAttribute(o,i))}function Ui(){return{enterAttrs:function(r,t,o,i){Object.entries(t.enterAttrs(o)).forEach(([u,m])=>{if(Array.isArray(m))throw"not implemented";typeof m=="object"?i.animateAttr(r,u,m):i.enterAttribute(t,r,u,m)})},attrs:function(r,t,o,i){var u=t.attrs?t.attrs(o):{};t.attrs2&&Object.entries(t.attrs2).forEach(([m,h])=>{u[m]=typeof h=="function"?h(o):h}),Object.entries(u).forEach(([m,h])=>{i.enterAttribute(t,r,m,h)})},enterStyles:function(r,t,o,i){Object.entries(t.enterStyles(o)).forEach(([u,m])=>{if(Array.isArray(m))throw"not implemented";typeof m=="object"?i.animateCSS(r,u,m):r.style.setProperty(u,m)})},style:function(r,t,o,i){Object.entries(t.style(o)).forEach(([u,m])=>{r.style.setProperty(u,m)})},events:function(r,t,o,i){r.__datum={...o},Object.entries(t.events).map(([u,m])=>r["on"+u]=h=>m(r.__datum,h))}}}function Qt(r){let t=[],o=Ui();return r.enterAttrs&&t.push(o.enterAttrs),(r.attrs||r.attrs2)&&t.push(o.attrs),r.enterStyles&&t.push(o.enterStyles),r.style&&t.push(o.style),r.events&&t.push(o.events),t}function os(r){return(t,o,i,u,m,h,_)=>{var E={},A=new Map,N=[],M=i;return h.forEach((j,te)=>{if(t.svg){var I=document.createElementNS("http://www.w3.org/2000/svg",t.tag);Object.assign(I,{_attrs:{},_styles:{},_attrsV:{},_styleV:{},_colors:{}})}else{var I=document.createElement(t.tag);Object.assign(I,{_attrs:{},_styles:{},_attrsV:{},_styleV:{},_colors:{}})}I.key=t.key(j),E[I.key]=!0,N.push(I),u[t.loop_alias]=j,t.loop_key_alias&&(u[t.loop_key_alias]=te),t.enterProps&&t.enterProps(I,t,u,_),t.children?_.Enter_Children(I,t.children,u):t.text&&(typeof t.text=="function"?I.textContent=I.__lastText=t.text(u):I.textContent=I.__lastText=t.text),te===0&&!M?o.prepend(I):M.after(I),M=I}),o.__i__[m]={length:h.length,exit:A,elements:N,keys:E},M}}function Un(r,t,o,i){t.enterProps&&t.enterProps(r,t,o,i),t.children?Ye(r,t.children,o):typeof t.text=="function"?r.textContent=r.__lastText=t.text(o):r.textContent=r.__lastText=t.text}function as(r,t,o,i,u){return r.element=document.createTextNode(r.content),o?o.after(r.element):t.prepend(r.element),t.__i__[u]={exit:!1},r.element}function is(r){return(t,o,i,u,m,h,_)=>{if(t.svg){var E=document.createElementNS("http://www.w3.org/2000/svg",t.tag);Object.assign(E,{_attrs:{},_styles:{},_attrsV:{},_styleV:{},_colors:{}})}else{var E=document.createElement(t.tag);Object.assign(E,{_attrs:{},_styles:{},_attrsV:{},_styleV:{},_colors:{}})}return t.enterProps&&t.enterProps(E,t,u,_),t.text&&(typeof t.text=="function"?E.textContent=E.__lastText=t.text(u):E.textContent=E.__lastText=t.text),i?i.after(E):o.prepend(E),o.__i__[m]={exit:!1},E}}function cs(r){return(t,o,i,u,m,h,_)=>{if(t.svg){var E=document.createElementNS("http://www.w3.org/2000/svg",t.tag);Object.assign(E,{_attrs:{},_styles:{},_attrsV:{},_styleV:{},_colors:{}})}else{var E=document.createElement(t.tag);Object.assign(E,{_attrs:{},_styles:{},_attrsV:{},_styleV:{},_colors:{}})}return t.enterProps&&t.enterProps(E,t,u,_),i?i.after(E):o.prepend(E),_.Enter_Children(E,t.children,u),o.__i__[m]={exit:!1},E}}function Ye(r,t,o){r.__i__={};var i;t.forEach((u,m)=>{if(u.if&&!u.if(o)){r.__i__[m]=!1;return}if(u.loop){let h=u.loop(o);if(h.length){i=u.enter(u,r,i,o,m,h,he);return}else{r.__i__[m]=!1;return}}else{i=u.enter(u,r,i,o,m,void 0,he);return}})}function ls(r){if(r.tag==="#text"){r.enter=as;return}r.enterProps=Qt(r),r.updateProps=Wt(r),r.Update_Tag=Vt(r),r.loop?r.enter=os(r):r.enter=r.children?cs(r):is(r)}var ji=["svg","g","path","polygon","rect","circle","line","clipPath","cursor","defs","desc","ellipse","filter","font","glyph","image","text","textPath","animate","animateMotion","animateTransform"];function jn(r,t,o){return r.forEach((i,u)=>{ji.includes(i.tag)&&(i.svg=!0),i.context=[...t],i.loop_alias&&(i.loop=new Function(`return ({ ${i.context.join(",")} }) => ${i.loop_fn}`)(),i.context.push(i.loop_alias),i.loop_key_alias&&i.context.push(i.loop_key_alias)),i.textFn&&(i.text=new Function(`return ({ ${i.context.join(",")} }) => ${i.textFn}`)(),delete i.textFn),i.if&&(i.if=new Function(`return ({ ${i.context.join(",")} }) => ${i.if}`)()),i.events&&Object.entries(i.events).forEach(([m,h])=>{typeof h=="string"&&(i.events[m]=new Function(`return ({ ${i.context.join(",")} }, event) => ${h}`)())}),["style","attrs","enterStyles","updateStyles","exitStyles","enterAttrs","updateAttrs","exitAttrs"].forEach(m=>{i[m]&&(i[m]=new Function(`return ({ ${i.context.join(",")} }) => ({${i[m]}})`)())}),i.attrs2&&(Object.keys(i.attrs2).length&&(i.attrs3={}),Object.entries(i.attrs2).forEach(([m,h])=>{typeof h=="object"&&h.type==="jsAttribute"&&(i.attrs3[m]=i.attrs2[m]=new Function(`return ({ ${i.context.join(",")} }) => ${h.value+(h.args||"")}`)())}),Object.keys(i.attrs3).length||delete i.attrs3),ls(i),i.children&&jn(i.children,i.context,o)}),r}function zi(r){return r.filter(t=>{if(t.nodeType==="bracket"){let o=t.innerContent.split(" ").join("");if(["","/","@","@/","/@"].includes(o))throw`Empty tag <${o}>`}return!(t.nodeType==="text"&&!t.content.trim().length)})}function Gi(r=""){return zi(rt(r,{skip:!0,pairs:["<>","{}","()","[]"]}))}function us(r,t=[],o=!1){return jn(Qr(Wr(Gi(r)),t),["state"],o)}var Yi="static|template|state|class|style";function qi(r){return r.split(/\r\n|\n|\r/)}function Ji(r,t){let o=r.match(new RegExp(`^\\s*<!(${t})>\\s*$`,"i"));return o?o[1]:null}function Vi(r,t){let o=r.match(new RegExp(`^\\s*<!${t}\\s+([^>]*)>\\s*$`,"i"));return o?o[1]:null}async function Wi(r){let t=qi(r),o={};var i=void 0,u=0;for(let m=0;m<t.length;m++){let h=t[m];if(!h.trim().length)continue;let _=Ji(h,Yi+"|walt");if(!(!_&&["css","import","tag"].some(E=>{let A=Vi(h,E);if(A)return i=E,o[i]||(o[i]=[]),o[E].push(i==="tag"?{value:A,line:m}:A),!0}))){if(!i&&!_){i="template",u=m,o.template="",o.template+=`
`+h;continue}if(_){if(i=_,!o[_])o[_]="";else throw`duplicate <!${_}> block at line ${m}`;continue}else{if(["css","import","tag"].includes(i))if(!o.template)i="template",u=m,o.template="";else{if(h.trim().startsWith("//"))continue;throw`unexpected "${h.trim()}" at line ${m}. Template started at line ${u}`}o[i]+=`
`+h;continue}}}return o}function it(r){return['"',"'","`"].includes(r[0])&&r[0]==r[r.length-1]?r.substring(1,r.length-1).trim():r.trim()}function Qi(r){let t={},o=_t(r.value," ",!0).map(it);if(o.length>2)throw`excess arguments <!tag ${r.value}> at line ${r.line}`;if(o.some(i=>!i))throw`empty argument <!tag ${r.value}> at line ${r.line}`;if(o.length===1){if(o[0][0]==="@")throw`alias is present but path is not <!tag ${r.value}> at line ${r.line}`;t.alias="@"+o[0].split("\\").pop().split("/").pop(),t.path=o[0]}else{if(o[0][0]!=="@")throw`missing alias identifier "@" <!tag ${r.value}> at line ${r.line}`;t.alias=o[0],t.path=o[1]}return t}function Ki(r){if(_t(r," ",!0).length>1)throw`excess parameters <!import ${r}>`;return it(r)}function Kt(r){try{Function("var "+r)}catch(t){return!1}return!0}function Hi(r){let t=_t(r," ",!0);if(t.length<3)throw`not enough parameters <!import ${r}>`;if(t.length===3){if(t[1].toLowerCase()!=="from")throw`wrong parameters <!import ${r}>`;if(t[0].startsWith("{")&&t[0].endsWith("}")){let i=t[0].substring(1,t[0].length-1);if(!i.length)throw`wrong parameters <!import ${r}>`;if(!i.split(",").map(m=>m.trim()).every(Kt))throw`invalid variable name <!import ${r}>`;return{type:"object",import:t[0],path:it(t[2])}}else{if(!Kt(t[0]))throw`invalid variable name <!import ${r}>`;return{type:"var",import:t[0],path:it(t[2])}}}else{try{var o=rt(r,{pairs:["{}"]})}catch(i){throw`invalid variable name <!import ${r}>`}if(o.length>2)throw`wrong parameters <!import ${r}>`;if(o.length===1){if(o[0].nodeType==="bracket")throw`wrong parameters <!import ${r}>`;if(t[0]==="*"&&t[1].toLowerCase()==="as"&&t[3].toLowerCase()==="from"&&t.length===5){if(!Kt(t[2]))throw`invalid variable name <!import ${r}>`;return{type:"*",import:t[2],path:it(t[4])}}else throw`wrong parameters <!import ${r}>`}else{let i=_t(o[1].content," ",!0);if(i.length!==2||i[0].toLowerCase()!=="from")throw`wrong parameters <!import ${r}>`;if(!o[0].innerContent.trim().length)throw`wrong parameters <!import ${r}>`;let u=o[0].innerContent.split(",").map(m=>m.trim());if(!u.every(Kt))throw`invalid variable name <!import ${r}>`;return{type:"object",import:"{"+u.join(",")+"}",path:it(i[1])}}}}async function ps(r){let t=await Wi(r);return t.tag&&(t.tag=t.tag.map(Qi)),t.css&&(t.css=t.css.map(Ki)),t.import&&(t.import=t.import.map(Hi)),t}function Xi(r){return["Update_Tag","enterProps","updateProps"].forEach(t=>{Array.isArray(r[t])&&(r[t].length?r[t]=rs(...r[t]):delete r[t])}),r}function zn(r){r.forEach((t,o)=>{r[o]=Xi(t),t.children&&zn(t.children)})}var ct=class{connectedCallback(){Ye(this.document,this.component,{state:this.state}),this.__proto__.setAttribute=Zi,delete this.__proto__.initialize,this.connected&&setTimeout(()=>{this.connected()},0)}disconnectedCallback(){this.disconnected&&this.disconnected()}render(){Tt(this.document,this.component,{state:this.state})}setAttribute(t,o){this.state[t]=o}initialize(){if(this.component=this.initial_component,zn(this.component),this.window_events={},this.css.length){let t=document.createElement("style");t.textContent=this.css,this.document.append(t)}}emitNative(t,o){this.dispatchEvent(new CustomEvent(t,{cancelable:!1,bubbles:!1,detail:o}))}on(t,o,i){this.window_events[t]||(this.window_events[t]=[]);let u=this.window_events[t].find(h=>h.callback===o),m=(...h)=>o.call(this,...h);u||(this.window_events[t].push({callback:o,cb:m}),window.addEventListener(t,m,i))}off(t,o){if(!this.window_events[t])return;let i=this.window_events[t].findIndex(u=>u.callback===o);i!==-1&&(window.removeEventListener(t,this.window_events[t][i].cb),this.window_events[t].splice(i,1))}};function Zi(r,t){this.state[r]=t,setTimeout(()=>{Tt(this.document,this.component,{state:this.state})},0)}var Ht=(r,t)=>Object.getOwnPropertyNames(t.prototype).filter(o=>o!=="constructor").forEach(o=>r.prototype[o]=t.prototype[o]);var ec=function(r){"use strict";var t=i,o=Object.prototype.hasOwnProperty;function i(){for(var s={},e=0;e<arguments.length;e++){var n=arguments[e];for(var a in n)o.call(n,a)&&(s[a]=n[a])}return s}let u=s=>s;function m(s){function e(n){if(!Array.isArray(n))throw new Error("Transform must be used on an Array. Received "+JSON.stringify(n));let a=(()=>{let[y]=n;return y.Type in s&&typeof s[y.Type]=="function"?s[y.Type]:u})();if(a.length===2)return a(n,e);let[c,...l]=a(n),f=c.params.filter(Boolean).map(y=>e([y,...l]));return t(c,{params:f})}return e}function h(s){let e=n=>{if(n==null)return n;let a=(()=>"*"in s&&typeof s["*"]=="function"?s["*"]:n.Type in s&&typeof s[n.Type]=="function"?s[n.Type]:u)();if(a.length===2)return a(n,e);let c=a(n),l=c.params.map(e);return t(c,{params:l})};return e}var _={map:m,mapNode:h},E=_,A=E.map,N=E.mapNode,M=function(s){let e=n=>{if(n==null)return n;let{params:a}=n,c=(()=>"*"in s&&typeof s["*"]=="function"?s["*"]:n.Type in s&&typeof s[n.Type]=="function"?s[n.Type]:()=>n)();return c.length===2?(c(n,e),n):(c(n),a.forEach(e),n)};return e},j=M,te=function(s,e,n,a,c,l,f,y){if(e===void 0)throw new Error("invariant requires an error message argument");if(!s){var p;if(e===void 0)p=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var v=[n,a,c,l,f,y],b=0;p=new Error(e.replace(/%s/g,function(){return v[b++]})),p.name="Invariant Violation"}throw p.framesToPop=1,p}},I=te,ve=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ne(s){return s&&s.__esModule?s.default:s}function re(s,e){return e={exports:{}},s(e,e.exports),e.exports}var V=re(function(s,e){(function(n,a){a(e)})(ve,function(n){let a={whitespace:/[ \t]+/,comment:[{match:/\/\/.*?$/},{match:/\/\*[^]*?\*\//,lineBreaks:!0}],number:[{match:/0[xX][0-9a-fA-F]+/},{match:/0[oO][0-9]+/},{match:/0[bB][01]+/},{match:/(?:[0-9]+(?:\.[0-9]+)?e-?[0-9]+)/},{match:/[0-9]+\.[0-9]+|[0-9]+/}],char:[{match:/'(?:\\['\\bfnrtv0]|[^'\\\n])'/,value:ze=>ze.slice(1,-1)}],string:[{match:/"(?:\\["\\rn]|[^"\\\n])*?"/,value:ze=>ze.slice(1,-1)},{match:/'(?:\\['\\bfnrtv0]|[^'\\\n])*?'/,value:ze=>ze.slice(1,-1)},{match:/`(?:\\['\\bfnrtv0]|[^'\\])*?`/,value:ze=>ze.slice(1,-1)}],identifier:{match:/[A-Za-z_$][A-Za-z0-9_$]*/,keywords:{keyword:["break","if","else","import","as","from","export","return","switch","case","default","const","let","for","continue","do","while","throw","function","global","module","type","lambda"],type:["i32","i64","f32","f64","bool"]}},punctuator:["+","++","-","--",">>",">>>","<<","=","==","+=","-=","=>","<=",">=","!=","%","*","/","^","&","~","|","!","**",":","(",")",".","{","}",",","[","]",";",">","<","?","||","&&","{","}","..."],newline:{match:/(?:\r\n|\r|\n)/,lineBreaks:!0}},c="Program",l="Keyword",f="Export",y="Import",p="Statement",v="IfThenElse",b="Select",g="Else",w="UnaryExpression",L="BinaryExpression",R="TernaryExpression",F="NumberLiteral",z="StringLiteral",X="CharacterLiteral",Q="Punctuator",Ce="Identifier",pe="ArraySubscript",O="Constant",D="Type",U="ArrayType",Y="DeclType",q="GenericType",J="UserType",K="FunctionType",Z="Declaration",ee="StaticDeclaration",ae="StaticValueList",_e="ImmutableDeclaration",ge="FunctionDeclaration",me="ArrayDeclaration",nt="IndirectFunctionCall",dt="FunctionCall",je="Loop",bt="MemoryAssignment",ie="Assignment",xr="AssignmentExpression",Ar="Param",gn="Typedef",vn="Struct",Sn="UnionType",Tn="ReturnStatement",En="Sequence",xn="ObjectLiteral",An="Pair",wr="TypeCast",wn="Break",Cn="Comment",On="Sizeof",$n="Spread",Cr="Closure",Ln="Noop",Or="ClosureType",Pn="Block",$r="ObjectField",Lr="FunctionIndex",Pr="FunctionIdentifier",Ir="FunctionPointer",Nr="FunctionArguments",Rr="FunctionResult",Br="FunctionLocals",kr="NativeMethod",In="Unreachable",Mr="Access",Fr="i32",Dr="f32",Ur="i64",jr="f64",zr="Memory",Gr="Table",Yr="bool";n.Program=c,n.Keyword=l,n.Export=f,n.Import=y,n.Statement=p,n.IfThenElse=v,n.Select=b,n.Else=g,n.UnaryExpression=w,n.BinaryExpression=L,n.TernaryExpression=R,n.NumberLiteral=F,n.StringLiteral=z,n.CharacterLiteral=X,n.Punctuator=Q,n.Identifier=Ce,n.ArraySubscript=pe,n.Constant=O,n.Type=D,n.ArrayType=U,n.DeclType=Y,n.GenericType=q,n.UserType=J,n.FunctionType=K,n.Declaration=Z,n.StaticDeclaration=ee,n.StaticValueList=ae,n.ImmutableDeclaration=_e,n.FunctionDeclaration=ge,n.ArrayDeclaration=me,n.IndirectFunctionCall=nt,n.FunctionCall=dt,n.Loop=je,n.MemoryAssignment=bt,n.Assignment=ie,n.AssignmentExpression=xr,n.Param=Ar,n.Typedef=gn,n.Struct=vn,n.UnionType=Sn,n.ReturnStatement=Tn,n.Sequence=En,n.ObjectLiteral=xn,n.Pair=An,n.TypeCast=wr,n.Break=wn,n.Comment=Cn,n.Sizeof=On,n.Spread=$n,n.Closure=Cr,n.Noop=Ln,n.ClosureType=Or,n.Block=Pn,n.ObjectField=$r,n.FunctionIndex=Lr,n.FunctionIdentifier=Pr,n.FunctionPointer=Ir,n.FunctionArguments=Nr,n.FunctionResult=Rr,n.FunctionLocals=Br,n.NativeMethod=kr,n.Unreachable=In,n.Access=Mr,n.i32=Fr,n.f32=Dr,n.i64=Ur,n.f64=jr,n.Memory=zr,n.Table=Gr,n.bool=Yr,n.builtinTypes={i32:Fr,f32:Dr,i64:Ur,f64:jr,Memory:zr,Table:Gr,bool:Yr},n.statements={Program:c,Export:f,Import:y,IfThenElse:v,Else:g,Declaration:Z,ImmutableDeclaration:_e,FunctionDeclaration:ge,ArrayDeclaration:me,Loop:je,MemoryAssignment:bt,Assignment:ie,Typedef:gn,Struct:vn,UnionType:Sn,ReturnStatement:Tn,Sequence:En,ObjectLiteral:xn,Pair:An,Break:wn,Comment:Cn,Sizeof:On,Spread:$n,Noop:Ln,Block:Pn,Unreachable:In},n.default={Program:c,Keyword:l,Export:f,Import:y,Statement:p,IfThenElse:v,Select:b,Else:g,UnaryExpression:w,BinaryExpression:L,TernaryExpression:R,NumberLiteral:F,StringLiteral:z,CharacterLiteral:X,Punctuator:Q,Identifier:Ce,ArraySubscript:pe,Constant:O,Type:D,ArrayType:U,DeclType:Y,GenericType:q,UserType:J,FunctionType:K,Declaration:Z,ImmutableDeclaration:_e,FunctionDeclaration:ge,ArrayDeclaration:me,StaticDeclaration:ee,StaticValueList:ae,IndirectFunctionCall:nt,FunctionCall:dt,Loop:je,MemoryAssignment:bt,Assignment:ie,AssignmentExpression:xr,Param:Ar,Typedef:gn,Struct:vn,UnionType:Sn,ReturnStatement:Tn,Sequence:En,ObjectLiteral:xn,Pair:An,TypeCast:wr,Break:wn,Comment:Cn,Sizeof:On,Spread:$n,Closure:Cr,Access:Mr,Noop:Ln,ClosureType:Or,Block:Pn,ObjectField:$r,FunctionIndex:Lr,FunctionIdentifier:Pr,FunctionPointer:Ir,FunctionArguments:Nr,FunctionResult:Rr,FunctionLocals:Br,NativeMethod:kr,Unreachable:In},n.tokens=a,Object.defineProperty(n,"__esModule",{value:!0})})}),d=ne(V),be=V.tokens,Oe=V.semantics,ye=V.builtinTypes,ut=V.statements,pt=V.i32,Fe=V.f32,yc=V.i64,hc=V.f64,As=re(function(s){(function(e,n){s.exports?s.exports=n():e.moo=n()})(ve,function(){var e=Object.prototype.hasOwnProperty,n=typeof Object.assign=="function"?Object.assign:function(O,D){if(O==null)throw new TypeError("Target cannot be null or undefined");O=Object(O);for(var U=1;U<arguments.length;U++){var Y=arguments[U];if(Y!=null)for(var q in Y)e.call(Y,q)&&(O[q]=Y[q])}return O},a=typeof new RegExp().sticky=="boolean";function c(O){return O&&O.constructor===RegExp}function l(O){return O&&typeof O=="object"&&O.constructor!==RegExp&&!Array.isArray(O)}function f(O){return O.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function y(O){var D=new RegExp("|"+O);return D.exec("").length-1}function p(O){return"("+O+")"}function v(O){var D=O.map(function(U){return"(?:"+U+")"}).join("|");return"(?:"+D+")"}function b(O){if(typeof O=="string")return"(?:"+f(O)+")";if(c(O)){if(O.ignoreCase)throw new Error("RegExp /i flag not allowed");if(O.global)throw new Error("RegExp /g flag is implied");if(O.sticky)throw new Error("RegExp /y flag is implied");if(O.multiline)throw new Error("RegExp /m flag is implied");return O.source}else throw new Error("not a pattern: "+O)}function g(O){for(var D=Object.getOwnPropertyNames(O),U=[],Y=0;Y<D.length;Y++){var q=D[Y],J=O[q],K=Array.isArray(J)?J:[J],Z=[];K.forEach(function(ee){l(ee)?(Z.length&&U.push(L(q,Z)),U.push(L(q,ee)),Z=[]):Z.push(ee)}),Z.length&&U.push(L(q,Z))}return U}function w(O){for(var D=[],U=0;U<O.length;U++){var Y=O[U];if(!Y.name)throw new Error("Rule has no name: "+JSON.stringify(Y));D.push(L(Y.name,Y))}return D}function L(O,D){(typeof D!="object"||Array.isArray(D)||c(D))&&(D={match:D});var U=n({tokenType:O,lineBreaks:!!D.error,pop:!1,next:null,push:null,error:!1,value:null,getType:null},D),Y=U.match;return U.match=Array.isArray(Y)?Y:Y?[Y]:[],U.match.sort(function(q,J){return c(q)&&c(J)?0:c(J)?-1:c(q)?1:J.length-q.length}),U.keywords&&(U.getType=X(U.keywords)),U}function R(O,D){O=Array.isArray(O)?w(O):g(O);for(var U=null,Y=[],q=[],J=0;J<O.length;J++){var K=O[J];if(K.error){if(U)throw new Error("Multiple error rules not allowed: (for token '"+K.tokenType+"')");U=K}if(K.match.length!==0){Y.push(K);var Z=v(K.match.map(b)),ee=new RegExp(Z);if(ee.test(""))throw new Error("RegExp matches empty string: "+ee);var ae=y(Z);if(ae>0)throw new Error("RegExp has capture groups: "+ee+`
Use (?: \u2026 ) instead`);if(!D&&(K.pop||K.push||K.next))throw new Error("State-switching options are not allowed in stateless lexers (for token '"+K.tokenType+"')");if(!K.lineBreaks&&ee.test(`
`))throw new Error("Rule should declare lineBreaks: "+ee);q.push(p(Z))}}var _e=a?"":"|(?:)",ge=a?"ym":"gm",me=new RegExp(v(q)+_e,ge);return{regexp:me,groups:Y,error:U}}function F(O){var D=R(O);return new Q({start:D},"start")}function z(O,D){var U=Object.getOwnPropertyNames(O);D||(D=U[0]);for(var Y=Object.create(null),q=0;q<U.length;q++){var J=U[q];Y[J]=R(O[J],!0)}for(var q=0;q<U.length;q++)for(var K=Y[U[q]].groups,Z=0;Z<K.length;Z++){var ee=K[Z],ae=ee&&(ee.push||ee.next);if(ae&&!Y[ae])throw new Error("Missing state '"+ae+"' (in token '"+ee.tokenType+"' of state '"+U[q]+"')");if(ee&&ee.pop&&+ee.pop!=1)throw new Error("pop must be 1 (in token '"+ee.tokenType+"' of state '"+U[q]+"')")}return new Q(Y,D)}function X(O){for(var D=Object.create(null),U=Object.create(null),Y=Object.getOwnPropertyNames(O),q=0;q<Y.length;q++){var J=Y[q],K=O[J],Z=Array.isArray(K)?K:[K];Z.forEach(function(me){if((U[me.length]=U[me.length]||[]).push(me),typeof me!="string")throw new Error("keyword must be string (in keyword '"+J+"')");D[me]=J})}function ee(me){return JSON.stringify(me)}var ae="";ae+=`(function(value) {
`,ae+=`switch (value.length) {
`;for(var _e in U){var ge=U[_e];ae+="case "+_e+`:
`,ae+=`switch (value) {
`,ge.forEach(function(me){var nt=D[me];ae+="case "+ee(me)+": return "+ee(nt)+`
`}),ae+=`}
`}return ae+=`}
`,ae+="})",(0,eval)(ae)}var Q=function(O,D){this.startState=D,this.states=O,this.buffer="",this.stack=[],this.reset()};Q.prototype.reset=function(O,D){return this.buffer=O||"",this.index=0,this.line=D?D.line:1,this.col=D?D.col:1,this.setState(D?D.state:this.startState),this},Q.prototype.save=function(){return{line:this.line,col:this.col,state:this.state}},Q.prototype.setState=function(O){if(!(!O||this.state===O)){this.state=O;var D=this.states[O];this.groups=D.groups,this.error=D.error||{lineBreaks:!0,shouldThrow:!0},this.re=D.regexp}},Q.prototype.popState=function(){this.setState(this.stack.pop())},Q.prototype.pushState=function(O){this.stack.push(this.state),this.setState(O)},Q.prototype._eat=a?function(O){return O.exec(this.buffer)}:function(O){var D=O.exec(this.buffer);return D[0].length===0?null:D},Q.prototype._getGroup=function(O){if(O===null)return-1;for(var D=this.groups.length,U=0;U<D;U++)if(O[U+1]!==void 0)return U;throw new Error("oops")};function Ce(){return this.value}if(Q.prototype.next=function(){var O=this.re,D=this.buffer,U=O.lastIndex=this.index;if(U!==D.length){var Y=this._eat(O),q=this._getGroup(Y),J,K;q===-1?(J=this.error,K=D.slice(U)):(K=Y[0],J=this.groups[q]);var Z=0;if(J.lineBreaks){var ee=/\n/g,ae=1;if(K===`
`)Z=1;else for(;ee.exec(K);)Z++,ae=ee.lastIndex}var _e={type:J.getType&&J.getType(K)||J.tokenType,value:J.value?J.value(K):K,text:K,toString:Ce,offset:U,lineBreaks:Z,line:this.line,col:this.col},ge=K.length;if(this.index+=ge,this.line+=Z,Z!==0?this.col=ge-ae+1:this.col+=ge,J.shouldThrow)throw new Error(this.formatError(_e,"invalid syntax"));return J.pop?this.popState():J.push?this.pushState(J.push):J.next&&this.setState(J.next),_e}},typeof Symbol<"u"&&Symbol.iterator){var pe=function(O){this.lexer=O};pe.prototype.next=function(){var O=this.lexer.next();return{value:O,done:!O}},pe.prototype[Symbol.iterator]=function(){return this},Q.prototype[Symbol.iterator]=function(){return new pe(this)}}return Q.prototype.formatError=function(O,D){var U=O.value,Y=O.offset,q=O.lineBreaks?U.indexOf(`
`):U.length,J=Math.max(0,Y-O.col+1),K=this.buffer.substring(J,Y+q);return D+=" at line "+O.line+" col "+O.col+`:

`,D+="  "+K+`
`,D+="  "+Array(O.col).join(" ")+"^",D},Q.prototype.clone=function(){return new Q(this.states,this.state)},Q.prototype.has=function(O){for(var D in this.states)for(var U=this.states[D].groups,Y=0;Y<U.length;Y++){var q=U[Y];if(q.tokenType===O||q.keywords&&e.call(q.keywords,O))return!0}return!1},{compile:F,states:z,error:Object.freeze({error:!0})}})}),Wn=Array.prototype.slice,ws=function(s){return Wn.call(s)},Cs=function(s){return Wn.call(s,1)},Zt=function(s,e,n){var a=n-e.length;switch(a){case 0:return function(){return Ae(s,xe(e,arguments),n)};case 1:return function(c){return Ae(s,xe(e,arguments),n)};case 2:return function(c,l){return Ae(s,xe(e,arguments),n)};case 3:return function(c,l,f){return Ae(s,xe(e,arguments),n)};case 4:return function(c,l,f,y){return Ae(s,xe(e,arguments),n)};case 5:return function(c,l,f,y,p){return Ae(s,xe(e,arguments),n)};case 6:return function(c,l,f,y,p,v){return Ae(s,xe(e,arguments),n)};case 7:return function(c,l,f,y,p,v,b){return Ae(s,xe(e,arguments),n)};case 8:return function(c,l,f,y,p,v,b,g){return Ae(s,xe(e,arguments),n)};case 9:return function(c,l,f,y,p,v,b,g,w){return Ae(s,xe(e,arguments),n)};case 10:return function(c,l,f,y,p,v,b,g,w,L){return Ae(s,xe(e,arguments),n)};default:return Os(s,e,a)}},xe=function(s,e){return s.concat(ws(e))},Os=function(s,e,n){var a=$s(n),c="false||function("+a+"){ return processInvocation(fn, concatArgs(args, arguments)); }";return(0,eval)(c)},$s=function(s){for(var e=[],n=0;n<s;n+=1)e.push("a"+n.toString());return e.join(",")},Ls=function(s,e){return s.length>e?s.slice(0,e):s},Ae=function(s,e,n){return e=Ls(e,n),e.length===n?s.apply(null,e):Zt(s,e,n)},Re=function(s){return Zt(s,[],s.length)};Re.to=Re(function(s,e){return Zt(e,[],s)}),Re.adaptTo=Re(function(s,e){return Re.to(s,function(n){var a=Cs(arguments).concat(n);return e.apply(this,a)})}),Re.adapt=function(s){return Re.adaptTo(s.length,s)};var wt=Re;function B(s){return s[0]}function Ps(){let s=this.lexer,e=this.Syntax,{extendNode:n,drop:a,nth:c,nuller:l,nonEmpty:f,add:y,flatten:p,compose:v}=this.helpers,{node:b,binary:g,constant:w,identifier:L,statement:R,unary:F,ternary:z,subscript:X,access:Q,fun:Ce,declaration:pe,call:O,struct:D,result:U,string:Y,char:q,typedef:J,voidFun:K,type:Z,arrayType:ee,assignment:ae,forLoop:_e,whileLoop:ge,typeGeneric:me,spread:nt,builtinDecl:dt,assignmentExpr:je,addressOf:bt}=this.nodes(s);return{Lexer:s,ParserRules:[{name:"_$ebnf$1",symbols:[]},{name:"_$ebnf$1",symbols:["_$ebnf$1","wschar"],postprocess:function(ie){return ie[0].concat([ie[1]])}},{name:"_",symbols:["_$ebnf$1"],postprocess:function(ie){return null}},{name:"__$ebnf$1",symbols:["wschar"]},{name:"__$ebnf$1",symbols:["__$ebnf$1","wschar"],postprocess:function(ie){return ie[0].concat([ie[1]])}},{name:"__",symbols:["__$ebnf$1"],postprocess:function(ie){return null}},{name:"wschar",symbols:[/[ \t\n\v\f]/],postprocess:B},{name:"Struct",symbols:["TYPE","__","Identifier","_","EQUALS","_","Union","SEPARATOR"],postprocess:D},{name:"Struct",symbols:["TYPE","__","Identifier","_","EQUALS","_","NativeType","SEPARATOR"],postprocess:D},{name:"Union",symbols:["StructDefinition"],postprocess:B},{name:"Union",symbols:["StructDefinition","_","OR","_","Union"],postprocess:b(e.UnionType)},{name:"StructDefinition",symbols:["ArrayType"],postprocess:B},{name:"StructDefinition",symbols:["Identifier"],postprocess:B},{name:"StructDefinition",symbols:["LCB","_","StructBody","_","RCB"],postprocess:v(b(e.ObjectLiteral),p)},{name:"StructBody",symbols:["StructNameAndType"],postprocess:B},{name:"StructBody",symbols:["StructNameAndType","_","COMMA","_","StructBody"],postprocess:p},{name:"StructNameAndType",symbols:["Identifier","_","COLON","_","Type"],postprocess:b(e.Pair)},{name:"StructNameAndType",symbols:["AddressOf","_","COLON","_","Type"],postprocess:b(e.Pair)},{name:"AddressOf",symbols:["AND","Identifier"],postprocess:bt},{name:"TypeDef",symbols:["TYPE","__","Identifier","_","EQUALS","_","TypeDefinition","_","FATARROW","_","Type","_","SEPARATOR"],postprocess:v(J)},{name:"TypeDefinition",symbols:["LB","_","TypeList","_","RB"],postprocess:p},{name:"TypeDefinition",symbols:["LB","_","RB"],postprocess:p},{name:"TypeList",symbols:["Type"],postprocess:B},{name:"TypeList",symbols:["Type","_","COMMA","_","TypeList"],postprocess:p},{name:"_Type",symbols:["NativeType"],postprocess:B},{name:"_Type",symbols:["GenericType"],postprocess:B},{name:"_Type",symbols:["Identifier"],postprocess:B},{name:"ArrayType",symbols:["_Type","_","LSB","_","RSB"],postprocess:ee},{name:"Type",symbols:["_Type"],postprocess:B},{name:"Type",symbols:["ArrayType"],postprocess:B},{name:"GenericType",symbols:["Identifier","LT","_","StaticObjectLiteral","_","GT"],postprocess:me},{name:"StaticObjectLiteral",symbols:["LCB","_","RCB"],postprocess:v(b(e.ObjectLiteral))},{name:"StaticObjectLiteral",symbols:["LCB","_","StaticPropertyList","_","RCB"],postprocess:v(b(e.ObjectLiteral),p)},{name:"StaticPropertyValue",symbols:["Number"],postprocess:B},{name:"StaticPropertyValue",symbols:["Boolean"],postprocess:B},{name:"StaticPropertyValue",symbols:["StringLiteral"],postprocess:B},{name:"StaticProperty",symbols:["Identifier","_","COLON","_","StaticPropertyValue"],postprocess:b(e.Pair)},{name:"StaticPropertyList",symbols:["StaticProperty"],postprocess:B},{name:"StaticPropertyList",symbols:["StaticProperty","_","COMMA","_","StaticPropertyList"],postprocess:p},{name:"ObjectLiteral",symbols:["LCB","_","RCB"],postprocess:b(e.ObjectLiteral)},{name:"ObjectLiteral",symbols:["LCB","_","PropertyList","_","RCB"],postprocess:v(b(e.ObjectLiteral),p)},{name:"PropertyList",symbols:["Property"],postprocess:B},{name:"PropertyList",symbols:["Property","_","COMMA","_","PropertyList"],postprocess:p},{name:"Property",symbols:["Identifier","_","COLON","_","Ternary"],postprocess:b(e.Pair)},{name:"Property",symbols:["SPREAD","Identifier"],postprocess:nt},{name:"Property",symbols:["Identifier"],postprocess:B},{name:"Import",symbols:["IMPORT","_","ImportDefinition","__","FROM","__","StringLiteral","_","SEPARATOR"],postprocess:b(e.Import)},{name:"ImportDefinition",symbols:["LCB","_","ImportAndTypeList","_","RCB"],postprocess:v(b(e.ObjectLiteral),p)},{name:"ImportAndTypeList",symbols:["ImportName"],postprocess:B},{name:"ImportAndTypeList",symbols:["ImportAndType"],postprocess:B},{name:"ImportAndTypeList",symbols:["ImportName","_","COMMA","_","ImportAndTypeList"],postprocess:p},{name:"ImportAndTypeList",symbols:["ImportAndType","_","COMMA","_","ImportAndTypeList"],postprocess:p},{name:"ImportAndType",symbols:["ImportName","_","COLON","_","Type"],postprocess:b(e.Pair)},{name:"ImportAndType",symbols:["ImportName","_","AS","_","Identifier"],postprocess:b(e.BinaryExpression,{value:"as"})},{name:"ImportAndType",symbols:["ImportAndType","_","AS","_","Identifier"],postprocess:b(e.BinaryExpression,{value:"as"})},{name:"ImportName",symbols:["Identifier"],postprocess:B},{name:"If",symbols:["IF","_","LB","_","Expression","_","RB","_","BranchBody"],postprocess:b(e.IfThenElse)},{name:"If",symbols:["IF","_","LB","_","Expression","_","RB","_","BranchBody","_","Else"],postprocess:b(e.IfThenElse)},{name:"Else",symbols:["ELSE","_","BranchBody"],postprocess:b(e.Else)},{name:"BranchBody",symbols:["Statement"],postprocess:B},{name:"BranchBody",symbols:["Block"],postprocess:B},{name:"For",symbols:["FOR","_","LB","_","ForArg","_","SEPARATOR","_","Expression","_","SEPARATOR","_","ForArg","_","RB","_","BranchBody"],postprocess:_e},{name:"ForArg",symbols:["_Assignment"],postprocess:B},{name:"ForArg",symbols:["Ternary"],postprocess:B},{name:"While",symbols:["WHILE","_","LB","_","Expression","_","RB","_","BranchBody"],postprocess:ge},{name:"Break",symbols:["BREAK","_","SEPARATOR"],postprocess:b(e.Break)},{name:"Program",symbols:["_"],postprocess:v(b("Program",{value:"ROOT_NODE"}),p)},{name:"Program",symbols:["_","SourceElementList","_"],postprocess:v(b("Program",{value:"ROOT_NODE"}),p)},{name:"SourceElementList",symbols:["SourceElement"],postprocess:p},{name:"SourceElementList",symbols:["SourceElement","_","SourceElementList"],postprocess:v(a,p,p)},{name:"SourceElement",symbols:["Function"],postprocess:B},{name:"SourceElement",symbols:["GlobalDeclaration"],postprocess:B},{name:"SourceElement",symbols:["GlobalImmutableDeclaration"],postprocess:B},{name:"SourceElement",symbols:["StaticDeclaration"],postprocess:B},{name:"SourceElement",symbols:["Struct"],postprocess:B},{name:"SourceElement",symbols:["TypeDef"],postprocess:B},{name:"SourceElement",symbols:["Export"],postprocess:B},{name:"SourceElement",symbols:["Import"],postprocess:B},{name:"Statement",symbols:["ExpressionStatement"],postprocess:B},{name:"Statement",symbols:["Declaration"],postprocess:B},{name:"Statement",symbols:["ImmutableDeclaration"],postprocess:B},{name:"Statement",symbols:["Assignment"],postprocess:B},{name:"Statement",symbols:["If"],postprocess:B},{name:"Statement",symbols:["For"],postprocess:B},{name:"Statement",symbols:["While"],postprocess:B},{name:"Statement",symbols:["Break"],postprocess:B},{name:"Statement",symbols:["Unreachable"],postprocess:B},{name:"Statement",symbols:["ReturnStatement"],postprocess:B},{name:"Block",symbols:["LCB","_","RCB"],postprocess:b(e.Block)},{name:"Block",symbols:["LCB","_","StatementList","_","RCB"],postprocess:v(b(e.Block),p)},{name:"StatementList",symbols:["Statement"],postprocess:a},{name:"StatementList",symbols:["Statement","_","StatementList"],postprocess:p},{name:"Function",symbols:["FUNCTION","__","Identifier","_","FunctionParameters","_","Block"],postprocess:K},{name:"Function",symbols:["FUNCTION","__","Identifier","_","FunctionParameters","_","FunctionResult","_","Block"],postprocess:Ce},{name:"FunctionParameters",symbols:["LB","_","RB"],postprocess:b(e.FunctionArguments)},{name:"FunctionParameters",symbols:["LB","_","ParameterList","_","RB"],postprocess:v(b(e.FunctionArguments),p,p)},{name:"ParameterList",symbols:["NameAndType"],postprocess:B},{name:"ParameterList",symbols:["NameAndType","_","COMMA","_","ParameterList"],postprocess:p},{name:"NameAndType",symbols:["Identifier","_","COLON","_","DeclType"],postprocess:b(e.Pair)},{name:"DeclType",symbols:["Type"],postprocess:v(n({Type:e.DeclType}),c(0))},{name:"FunctionResult",symbols:["COLON","_","Type"],postprocess:v(U,a)},{name:"GlobalDeclaration",symbols:["LET","_","NameAndType","_","SEPARATOR"],postprocess:pe(e.Declaration)},{name:"GlobalDeclaration",symbols:["LET","_","NameAndType","_","EQUALS","_","Atom","_","SEPARATOR"],postprocess:pe(e.Declaration)},{name:"GlobalImmutableDeclaration",symbols:["CONST","_","Identifier","_","COLON","_","GenericType","_","SEPARATOR"],postprocess:dt},{name:"GlobalImmutableDeclaration",symbols:["CONST","_","NameAndType","_","EQUALS","_","ObjectLiteral","_","SEPARATOR"],postprocess:pe(e.ImmutableDeclaration)},{name:"GlobalImmutableDeclaration",symbols:["CONST","_","NameAndType","_","EQUALS","_","Atom","_","SEPARATOR"],postprocess:pe(e.ImmutableDeclaration)},{name:"Declaration",symbols:["LET","_","NameAndType","_","EQUALS","_","Expression","_","SEPARATOR"],postprocess:pe(e.Declaration)},{name:"Declaration",symbols:["LET","_","NameAndType","_","SEPARATOR"],postprocess:pe(e.Declaration)},{name:"ImmutableDeclaration",symbols:["CONST","_","NameAndType","_","EQUALS","_","Expression","_","SEPARATOR"],postprocess:pe(e.ImmutableDeclaration)},{name:"ImmutableDeclaration",symbols:["CONST","_","NameAndType","_","EQUALS","_","ObjectLiteral","_","SEPARATOR"],postprocess:pe(e.ImmutableDeclaration)},{name:"ImmutableDeclaration",symbols:["CONST","_","Identifier","_","COLON","_","GenericType","_","SEPARATOR"],postprocess:dt},{name:"StaticNameAndType",symbols:["Identifier","_","COLON","_","ArrayType"],postprocess:b(e.Pair)},{name:"StaticDeclaration",symbols:["CONST","_","StaticNameAndType","_","EQUALS","_","LSB","_","RSB","_","SEPARATOR"],postprocess:pe(e.StaticDeclaration)},{name:"StaticDeclaration",symbols:["CONST","_","StaticNameAndType","_","EQUALS","_","LSB","_","StaticValueList","_","RSB","_","SEPARATOR"],postprocess:v(pe(e.StaticDeclaration),p)},{name:"StaticValueList",symbols:["Atom"],postprocess:B},{name:"StaticValueList",symbols:["Atom","_","COMMA","_","StaticValueList"],postprocess:p},{name:"Unreachable",symbols:["THROW","_","SEPARATOR"],postprocess:b(e.Unreachable)},{name:"Unreachable",symbols:["THROW","_","Expression","_","SEPARATOR"],postprocess:b(e.Unreachable)},{name:"Pair",symbols:["Identifier","_","COLON","_","Identifier"],postprocess:b(e.Pair)},{name:"Export",symbols:["EXPORT","__","ImmutableDeclaration"],postprocess:b(e.Export,{value:"export"})},{name:"Export",symbols:["EXPORT","__","Function"],postprocess:b(e.Export,{value:"export"})},{name:"Export",symbols:["EXPORT","__","TypeDef"],postprocess:b(e.Export,{value:"export"})},{name:"Export",symbols:["EXPORT","__","Struct"],postprocess:b(e.Export,{value:"export"})},{name:"ReturnStatement",symbols:["RETURN","__","Expression","_","SEPARATOR"],postprocess:b(e.ReturnStatement)},{name:"ReturnStatement$subexpression$1",symbols:[{literal:";"}],postprocess:l},{name:"ReturnStatement",symbols:["RETURN","ReturnStatement$subexpression$1"],postprocess:b(e.ReturnStatement)},{name:"Assignment",symbols:["_Assignment","_","SEPARATOR"],postprocess:B},{name:"_Assignment",symbols:["Subscript","_","EQUALS","_","Expression"],postprocess:ie=>ae(ie,"=")},{name:"_Assignment",symbols:["Subscript","_","PLSEQUALS","_","Expression"],postprocess:ie=>ae(ie,"+=")},{name:"_Assignment",symbols:["Subscript","_","MINEQUALS","_","Expression"],postprocess:ie=>ae(ie,"-=")},{name:"_Assignment",symbols:["Subscript","_","EQUALS","_","ObjectLiteral"],postprocess:ie=>ae(ie,"=")},{name:"ExpressionStatement",symbols:["Call","_","SEPARATOR"],postprocess:B},{name:"Expression",symbols:["AssignmentExpression"],postprocess:B},{name:"AssignmentExpression",symbols:["Identifier","_","EQUALS","_","Ternary"],postprocess:ie=>je(ie,"=")},{name:"AssignmentExpression",symbols:["Identifier","_","PLSEQUALS","_","Ternary"],postprocess:ie=>je(ie,"+=")},{name:"AssignmentExpression",symbols:["Identifier","_","MINEQUALS","_","Ternary"],postprocess:ie=>je(ie,"-=")},{name:"AssignmentExpression",symbols:["Ternary"],postprocess:B},{name:"Ternary",symbols:["Ternary","_","QUESTION","_","TernaryPair"],postprocess:z},{name:"Ternary",symbols:["Binary"],postprocess:B},{name:"TernaryPair",symbols:["Expression","_","COLON","_","Expression"],postprocess:b(e.Pair)},{name:"Binary",symbols:["Logical"],postprocess:B},{name:"Logical",symbols:["Logical","_",{literal:"||"},"_","Bitwise"],postprocess:g},{name:"Logical",symbols:["Logical","_",{literal:"&&"},"_","Bitwise"],postprocess:g},{name:"Logical",symbols:["Bitwise"],postprocess:B},{name:"Bitwise",symbols:["Bitwise","_",{literal:"|"},"_","Sum"],postprocess:g},{name:"Bitwise",symbols:["Bitwise","_",{literal:"^"},"_","Sum"],postprocess:g},{name:"Bitwise",symbols:["Bitwise","_",{literal:"&"},"_","Sum"],postprocess:g},{name:"Bitwise",symbols:["Equality"],postprocess:B},{name:"Equality",symbols:["Equality","_",{literal:"=="},"_","Comparison"],postprocess:g},{name:"Equality",symbols:["Equality","_",{literal:"!="},"_","Comparison"],postprocess:g},{name:"Equality",symbols:["Comparison"],postprocess:B},{name:"Comparison",symbols:["Comparison","_",{literal:"<"},"_","Shift"],postprocess:g},{name:"Comparison",symbols:["Comparison","_",{literal:">"},"_","Shift"],postprocess:g},{name:"Comparison",symbols:["Comparison","_",{literal:"<="},"_","Shift"],postprocess:g},{name:"Comparison",symbols:["Comparison","_",{literal:">="},"_","Shift"],postprocess:g},{name:"Comparison",symbols:["Shift"],postprocess:B},{name:"Shift",symbols:["Shift","_",{literal:">>"},"_","Sum"],postprocess:g},{name:"Shift",symbols:["Shift","_",{literal:"<<"},"_","Sum"],postprocess:g},{name:"Shift",symbols:["Shift","_",{literal:">>>"},"_","Sum"],postprocess:g},{name:"Shift",symbols:["Sum"],postprocess:B},{name:"Sum",symbols:["Sum","_",{literal:"+"},"_","Product"],postprocess:g},{name:"Sum",symbols:["Sum","_",{literal:"-"},"_","Product"],postprocess:g},{name:"Sum",symbols:["Product"],postprocess:B},{name:"Product",symbols:["Product","_",{literal:"*"},"_","Typecast"],postprocess:g},{name:"Product",symbols:["Product","_",{literal:"/"},"_","Typecast"],postprocess:g},{name:"Product",symbols:["Product","_",{literal:"%"},"_","Typecast"],postprocess:g},{name:"Product",symbols:["Typecast"],postprocess:B},{name:"Typecast",symbols:["Expression","_","COLON","_","DeclType"],postprocess:b(e.Pair)},{name:"Typecast",symbols:["Expression","_","AS","_","DeclType"],postprocess:b(e.Pair)},{name:"Typecast",symbols:["Unary"],postprocess:B},{name:"Unary",symbols:[{literal:"!"},"Call"],postprocess:F},{name:"Unary",symbols:[{literal:"~"},"Call"],postprocess:F},{name:"Unary",symbols:[{literal:"-"},"Call"],postprocess:F},{name:"Unary",symbols:[{literal:"+"},"Call"],postprocess:F},{name:"Unary",symbols:[{literal:"++"},"Call"],postprocess:F},{name:"Unary",symbols:[{literal:"--"},"Call"],postprocess:F},{name:"Unary",symbols:["Call"],postprocess:B},{name:"Call",symbols:["Subscript","_","LB","_","ArgumentList","_","RB"],postprocess:v(O,p)},{name:"Call",symbols:["Subscript","_","LB","_","RB"],postprocess:O},{name:"Call",symbols:["Subscript"],postprocess:B},{name:"ArgumentList",symbols:["Expression"],postprocess:B},{name:"ArgumentList",symbols:["NativeType"],postprocess:B},{name:"ArgumentList",symbols:["Expression","_","COMMA","_","ArgumentList"],postprocess:p},{name:"Subscript",symbols:["Access","LSB","_","Expression","_","RSB","Subscript"],postprocess:X},{name:"Subscript",symbols:["Access","LSB","_","Expression","_","RSB"],postprocess:X},{name:"Subscript",symbols:["Access"],postprocess:B},{name:"Access",symbols:["Access","DOT","Identifier"],postprocess:v(Q,a)},{name:"Access",symbols:["NativeType","DOT","Access"],postprocess:v(Q,a)},{name:"Access",symbols:["Grouping"],postprocess:B},{name:"Grouping",symbols:["LB","_","Expression","_","RB"],postprocess:c(2)},{name:"Grouping",symbols:["Atom"],postprocess:B},{name:"Atom",symbols:["Identifier"],postprocess:B},{name:"Atom",symbols:["StringLiteral"],postprocess:B},{name:"Atom",symbols:["CharacterLiteral"],postprocess:B},{name:"Atom",symbols:["Number"],postprocess:B},{name:"NativeType",symbols:[s.has("type")?{type:"type"}:Z],postprocess:Z},{name:"Identifier",symbols:[s.has("identifier")?{type:"identifier"}:L],postprocess:L},{name:"Number",symbols:[s.has("number")?{type:"number"}:number],postprocess:w},{name:"StringLiteral",symbols:[s.has("string")?{type:"string"}:Y],postprocess:Y},{name:"CharacterLiteral",symbols:[s.has("char")?{type:"char"}:q],postprocess:q},{name:"word",symbols:[/[a-zA-Z_]/],postprocess:B},{name:"word",symbols:["word",/[a-zA-Z0-9_]/],postprocess:y},{name:"digit",symbols:[/[0-9]/],postprocess:B},{name:"digit",symbols:["digit",/[0-9]/],postprocess:y},{name:"SEPARATOR",symbols:["_",{literal:";"}],postprocess:l},{name:"QUESTION",symbols:[{literal:"?"}],postprocess:l},{name:"COMMA",symbols:[{literal:","}],postprocess:l},{name:"AND",symbols:[{literal:"&"}],postprocess:l},{name:"DOT",symbols:[{literal:"."}],postprocess:l},{name:"LB",symbols:[{literal:"("}],postprocess:l},{name:"RB",symbols:[{literal:")"}],postprocess:l},{name:"LSB",symbols:[{literal:"["}],postprocess:l},{name:"RSB",symbols:[{literal:"]"}],postprocess:l},{name:"LCB",symbols:[{literal:"{"}],postprocess:l},{name:"RCB",symbols:[{literal:"}"}],postprocess:l},{name:"OR",symbols:[{literal:"|"}],postprocess:l},{name:"COLON",symbols:[{literal:":"}],postprocess:l},{name:"EQUALS",symbols:[{literal:"="}],postprocess:l},{name:"PLSEQUALS",symbols:[{literal:"+="}],postprocess:l},{name:"MINEQUALS",symbols:[{literal:"-="}],postprocess:l},{name:"GT",symbols:[{literal:">"}],postprocess:l},{name:"LT",symbols:[{literal:"<"}],postprocess:l},{name:"FATARROW",symbols:[{literal:"=>"}],postprocess:l},{name:"SPREAD",symbols:[{literal:"..."}],postprocess:l},{name:"FUNCTION",symbols:[{literal:"function"}],postprocess:l},{name:"LET",symbols:[{literal:"let"}],postprocess:l},{name:"CONST",symbols:[{literal:"const"}],postprocess:l},{name:"EXPORT",symbols:[{literal:"export"}],postprocess:l},{name:"IMPORT",symbols:[{literal:"import"}],postprocess:l},{name:"AS",symbols:[{literal:"as"}],postprocess:l},{name:"FROM",symbols:[{literal:"from"}],postprocess:l},{name:"RETURN",symbols:[{literal:"return"}],postprocess:l},{name:"TYPE",symbols:[{literal:"type"}],postprocess:l},{name:"IF",symbols:[{literal:"if"}],postprocess:l},{name:"ELSE",symbols:[{literal:"else"}],postprocess:l},{name:"FOR",symbols:[{literal:"for"}],postprocess:l},{name:"WHILE",symbols:[{literal:"while"}],postprocess:l},{name:"SWITCH",symbols:[{literal:"switch"}],postprocess:l},{name:"DO",symbols:[{literal:"do"}],postprocess:l},{name:"THROW",symbols:[{literal:"throw"}],postprocess:l},{name:"BREAK",symbols:[{literal:"break"}],postprocess:l}],ParserStart:"Program"}}function Qn(s){return s[0]}function Kn(){let s=this.Syntax,{flatten:e}=this.helpers,{node:n}=this.nodes(this.lexer);return{Lexer:void 0,ParserRules:[{name:"TypeList",symbols:["DefaultArgument"],postprocess:Qn},{name:"TypeList",symbols:["DefaultArgument","_","COMMA","_","TypeList"],postprocess:e},{name:"DefaultArgument",symbols:["Type","_","EQUALS","_","Atom"],postprocess:n(s.Assignment)},{name:"ParameterList",symbols:["DefaultFunctionArgument"],postprocess:Qn},{name:"ParameterList",symbols:["DefaultFunctionArgument","_","COMMA","_","ParameterList"],postprocess:e},{name:"DefaultFunctionArgument",symbols:["NameAndType","_","EQUALS","_","Atom"],postprocess:n(s.Assignment)}],ParserStart:"TypeList"}}var Hn=re(function(s){(function(e,n){s.exports?s.exports=n():e.nearley=n()})(ve,function(){function e(y,p,v){return this.id=++e.highestId,this.name=y,this.symbols=p,this.postprocess=v,this}e.highestId=0,e.prototype.toString=function(y){function p(b){return b.literal?JSON.stringify(b.literal):b.type?"%"+b.type:b.toString()}var v=typeof y>"u"?this.symbols.map(p).join(" "):this.symbols.slice(0,y).map(p).join(" ")+" \u25CF "+this.symbols.slice(y).map(p).join(" ");return this.name+" \u2192 "+v};function n(y,p,v,b){this.rule=y,this.dot=p,this.reference=v,this.data=[],this.wantedBy=b,this.isComplete=this.dot===y.symbols.length}n.prototype.toString=function(){return"{"+this.rule.toString(this.dot)+"}, from: "+(this.reference||0)},n.prototype.nextState=function(y){var p=new n(this.rule,this.dot+1,this.reference,this.wantedBy);return p.left=this,p.right=y,p.isComplete&&(p.data=p.build()),p},n.prototype.build=function(){var y=[],p=this;do y.push(p.right.data),p=p.left;while(p.left);return y.reverse(),y},n.prototype.finish=function(){this.rule.postprocess&&(this.data=this.rule.postprocess(this.data,this.reference,f.fail))};function a(y,p){this.grammar=y,this.index=p,this.states=[],this.wants={},this.scannable=[],this.completed={}}a.prototype.process=function(y){for(var p=this.states,v=this.wants,b=this.completed,g=0;g<p.length;g++){var w=p[g];if(w.isComplete){if(w.finish(),w.data!==f.fail){for(var L=w.wantedBy,R=L.length;R--;){var F=L[R];this.complete(F,w)}if(w.reference===this.index){var z=w.rule.name;(this.completed[z]=this.completed[z]||[]).push(w)}}}else{var z=w.rule.symbols[w.dot];if(typeof z!="string"){this.scannable.push(w);continue}if(v[z]){if(v[z].push(w),b.hasOwnProperty(z))for(var X=b[z],R=0;R<X.length;R++){var Q=X[R];this.complete(w,Q)}}else v[z]=[w],this.predict(z)}}},a.prototype.predict=function(y){for(var p=this.grammar.byName[y]||[],v=0;v<p.length;v++){var b=p[v],g=this.wants[y],w=new n(b,0,this.index,g);this.states.push(w)}},a.prototype.complete=function(y,p){var v=y.nextState(p);this.states.push(v)};function c(y,p){this.rules=y,this.start=p||this.rules[0].name;var v=this.byName={};this.rules.forEach(function(b){v.hasOwnProperty(b.name)||(v[b.name]=[]),v[b.name].push(b)})}c.fromCompiled=function(b,p){var v=b.Lexer;b.ParserStart&&(p=b.ParserStart,b=b.ParserRules);var b=b.map(function(w){return new e(w.name,w.symbols,w.postprocess)}),g=new c(b,p);return g.lexer=v,g};function l(){this.reset("")}l.prototype.reset=function(y,p){this.buffer=y,this.index=0,this.line=p?p.line:1,this.lastLineBreak=p?-p.col:0},l.prototype.next=function(){if(this.index<this.buffer.length){var y=this.buffer[this.index++];return y===`
`&&(this.line+=1,this.lastLineBreak=this.index),{value:y}}},l.prototype.save=function(){return{line:this.line,col:this.index-this.lastLineBreak}},l.prototype.formatError=function(y,p){var v=this.buffer;if(typeof v=="string"){var b=v.indexOf(`
`,this.index);b===-1&&(b=v.length);var g=v.substring(this.lastLineBreak,b),w=this.index-this.lastLineBreak;return p+=" at line "+this.line+" col "+w+`:

`,p+="  "+g+`
`,p+="  "+Array(w).join(" ")+"^",p}else return p+" at index "+(this.index-1)};function f(y,p,v){if(y instanceof c)var b=y,v=p;else var b=c.fromCompiled(y,p);this.grammar=b,this.options={keepHistory:!1,lexer:b.lexer||new l};for(var g in v||{})this.options[g]=v[g];this.lexer=this.options.lexer,this.lexerState=void 0;var w=new a(b,0);this.table=[w],w.wants[b.start]=[],w.predict(b.start),w.process(),this.current=0}return f.fail={},f.prototype.feed=function(y){var p=this.lexer;p.reset(y,this.lexerState);for(var v;v=p.next();){var b=this.table[this.current];this.options.keepHistory||delete this.table[this.current-1];var g=this.current+1,w=new a(this.grammar,g);this.table.push(w);for(var L=v.text!==void 0?v.text:v.value,R=p.constructor===l?v.value:v,F=b.scannable,z=F.length;z--;){var X=F[z],Q=X.rule.symbols[X.dot];if(Q.test?Q.test(R):Q.type?Q.type===v.type:Q.literal===L){var Ce=X.nextState({data:R,token:v,isToken:!0,reference:g-1});w.states.push(Ce)}}if(w.process(),w.states.length===0){var pe=this.lexer.formatError(v,"invalid syntax")+`
`;pe+="Unexpected "+(v.type?v.type+" token: ":""),pe+=JSON.stringify(v.value!==void 0?v.value:v)+`
`;var O=new Error(pe);throw O.offset=this.current,O.token=v,O}this.options.keepHistory&&(b.lexerState=p.save()),this.current++}return b&&(this.lexerState=p.save()),this.results=this.finish(),this},f.prototype.save=function(){var y=this.table[this.current];return y.lexerState=this.lexerState,y},f.prototype.restore=function(y){var p=y.index;this.current=p,this.table[p]=y,this.table.splice(p+1),this.lexerState=y.lexerState,this.results=this.finish()},f.prototype.rewind=function(y){if(!this.options.keepHistory)throw new Error("set option `keepHistory` to enable rewinding");this.restore(this.table[y])},f.prototype.finish=function(){var y=[],p=this.grammar.start,v=this.table[this.table.length-1];return v.states.forEach(function(b){b.rule.name===p&&b.dot===b.rule.symbols.length&&b.reference===0&&b.data!==f.fail&&y.push(b)}),y.map(function(b){return b.data})},{Parser:f,Grammar:c,Rule:e}})}),Is=Hn.Parser,Ns=Hn.Grammar,Rs=(...s)=>s.reduce((e,n)=>(...a)=>e(n(...a))),P=Object.assign||function(s){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(s[a]=n[a])}return s},Bs=function(s,e){var n={};for(var a in s)e.indexOf(a)>=0||Object.prototype.hasOwnProperty.call(s,a)&&(n[a]=s[a]);return n};let W=wt((s,e)=>{let{meta:n}=s,a=Bs(s,["meta"]);return P({},e,{meta:P({},e.meta,n)},a)}),ks=s=>e=>e[s],Ms=()=>null,Ve=s=>Array.isArray(s)?!!s.length:s!=null,Fs=s=>`${s[0]}${s[1]}`,Ds=s=>s.reduce((e,n)=>(Array.isArray(n),e.concat(n)),[]),de=s=>s.filter(Ve);var Us={nth:ks,nuller:Ms,nonEmpty:Ve,add:Fs,flatten:Ds,compose:Rs,drop:de,extendNode:W};let js=s=>{let{col:e,line:n}=s;return s.lines.length?{col:e,line:n,sourceLine:s.lines[s.line-1]}:{col:e,line:n,sourceLine:""}};function zs(s){let e=(c,l={})=>f=>{let y=f.filter(Ve),{value:p="",meta:v={}}=l,b=js(s),g=y[y.length-1]&&y[y.length-1].range?y[y.length-1].range[1]:P({},b,{col:b.col+p.length});return{value:p,type:null,Type:c,toString(){},meta:v,range:[b,g],params:y}},n=c=>{let[l,f,y]=c.filter(Ve),p=d.BinaryExpression;return(f.value==="||"||f.value==="&&")&&(p=d.Select),e(p,{value:f.value})([l,y])},a=c=>{let[l]=de(c);return W({type:l!=null&&l.value!=="void"?l.value:null},e(d.FunctionResult)(c))};return{node:e,binary:n,constant:c=>{let l=c[0].value;return W({value:`${l}`,type:l.toString().indexOf(".")!==-1?"f32":"i32"},e(d.Constant)([]))},identifier:c=>e("Identifier",{value:c.join("")})([]),unary:([c,l])=>{let f=[l];return c.value==="-"&&(f=[P({},l,{value:"0",Type:d.Constant,params:[],meta:{}}),l]),W({value:c.value,params:f},e(d.UnaryExpression)([c,l]))},ternary:c=>W({value:"?"},e(d.TernaryExpression)(c)),subscript:c=>{let[l,f]=c.filter(Ve);return W({value:l.value,params:[l,f]},e(d.ArraySubscript)([l,f]))},access(c){return W({value:c[0].value+"."+c[1].value},e(d.Access)(c))},fun:c=>{let[l,f,y,p]=c.filter(Ve);return P({},l,{Type:d.FunctionDeclaration,meta:[],params:[f,y,p]})},declaration:c=>l=>{let[f,...y]=de(l),[p,v]=f.params;return W({value:p.value,type:v.value},e(c)(y))},call:c=>{let[l,...f]=de(c);return W({value:l.value},e(d.FunctionCall)([l,...f]))},struct:c=>{let[l,...f]=de(c);return W({value:l.value},e(d.Struct)(f))},result:a,string:c=>W({value:c[0].value,type:"i32"},e(d.StringLiteral)([])),char(c){return W({value:c[0].value,type:"i32"},e(d.CharacterLiteral)([]))},type(c){return W({value:c[0].value,type:c[0].value,params:[]},e(d.Type)(c))},arrayType(c){let f=de(c)[0];return W({value:f.value+"[]",type:f.type+"[]",params:[]},e(d.ArrayType)(c))},typeGeneric(c){let[l,f]=de(c);return W({value:l.value,type:l.value,params:[f]},e(d.Type)(c))},typedef:c=>{let[l,f,y]=de(c);return W({value:l.value,params:[e(d.FunctionArguments)(f),W({type:y.value},e(d.FunctionResult)([y]))],type:y.type},e(d.Typedef)([l,f,a]))},voidFun:c=>{let l=de(c),[f,y,p]=l,v=W({type:null},e(d.FunctionResult)([]));return W({value:f.value,params:[y,v,p]},e(d.FunctionDeclaration)(l))},assignment(c,l){if(["-=","+="].includes(l)){let f=l[0],[y,p]=de(c),v=n([y,{value:f},p]);return e(d.Assignment,{value:"="})([y,v])}return e(d.Assignment,{value:l})(c)},assignmentExpr(c,l){if(["-=","+="].includes(l)){let f=l[0],[y,p]=de(c),v=n([y,{value:f},p]);return e(d.AssignmentExpression,{value:"="})([y,v])}return e(d.AssignmentExpression,{value:l})(c)},forLoop(c){let[l,f,y,...p]=de(c);return e(d.Loop)([l,f,...p,y])},whileLoop(c){let l=e(d.Noop)([]);return e(d.Loop)([l,...c])},spread(c){return e(d.Spread)(c)},builtinDecl(c){let[l,f]=de(c);return W({value:l.value,type:f.value,params:[f]},e(d.ImmutableDeclaration)(c))},addressOf(c){let[l]=de(c);return W({value:l.value,params:[]},e("AddressOf")(c))}}}function Gs(){let s=As.compile(be);return{current:null,lines:[],get line(){return s.line},get col(){return s.col},save(){return s.save()},reset(e,n){return this.lines=e.split(`
`),s.reset(e,n)},next(){let e=s.next();for(;e&&e.type==="comment";)e=s.next();return this.current=e,this.current},formatError(e){return s.formatError(e)},has(e){return s.has(e)}}}var en=wt(function(s,e){let n=[Ps,Kn,...s],a={lexer:Gs(),nodes:zs,helpers:Us,Syntax:d},c=n.slice(1).reduce((f,y)=>{let p=y.call(a);return P({},f,{ParserRules:f.ParserRules.concat(p.ParserRules)})},n[0].call(a)),l=new Is(Ns.fromCompiled(c));return l.feed(e),I(l.results.length===1,`PANIC - Ambiguous Syntax! Number of productions (${l.results.length})`),l.results[0]});let Ys=s=>{let e,n=s.reduce((a,c)=>c(l=>a(l,e)),([a])=>a);return(a,c)=>(e=c,n(a,e))},qs=s=>{let e=[],n=s.reduce((a,c)=>(Object.entries(c).forEach(([l,f])=>{if(l==="*"){e.push(f);return}a[l]==null&&(a[l]=[...e]),a[l].push(f)}),a),{});return Object.entries(n).reduce((a,[c,l])=>(a[c]=Ys(l),a),{})},Xn=Symbol("scope namespace"),Zn=Symbol("signature");function Js(s,e){return[...s,{[Xn]:e,[Zn]:{result:null,arguments:null}}]}function Vs(s){return s.slice(0,-1)}function er(s){return s[s.length-1]}function Ws(s,e,n){let a=er(s);return a&&(a[e]=n),a}function Qs(s,e){let a=s.length-1;for(a;a>=0;a--){let c=s[a][e];if(c)return c}return null}function Ks(s,e){let n=Object.keys(s).indexOf(e);return n>-1?n:Object.keys(s).length}var Hs={enter:Js,exit:Vs,add:Ws,find:Qs,current:er,index:Ks,namespace:Xn,signature:Zn};let{enter:Xs,exit:Zs,add:eo,find:to,current:no,namespace:ro,signature:so,index:oo}=Hs;var Be={enter:Xs,exit:Zs,add:eo,find:to,current:no,namespace:ro,index:oo,signature:so},tr=Be.enter,ao=Be.exit,De=Be.current,We=Be.find,io=Be.add,nr=Be.index,rr=Be.namespace,Qe=Be.signature;let $e="function/index",Ct="LOCAL_INDEX",Le="global/index",Ot="type/const",ft="TYPE_INDEX",co="OBJECT_SIZE",tn="type/cast",nn="AST_METADATA",rn="FUNCTION_METADATA",ke=s=>{switch(s){case"i32":case"bool":return 0;case"i64":return 1;case"f32":return 2;case"f64":return 3;default:return-1}},sn=s=>{let e=s.params.reduce((a,{type:c})=>ke(a)<ke(c)?c:a,s.type),n=s.params.map(a=>a.type!=null&&ke(a.type)!==ke(e)?a.Type===d.Constant?W({type:e},a):W({type:e,value:a.value,Type:d.TypeCast,meta:{[tn]:{to:e,from:a.type}},params:[a]},a):a);return P({},s,{params:n,type:e})};function lo(){return{semantics(){let s=e=>([n,a])=>{let c=De(a.scopes),l=nr(c,n.value);return c[n.value]=W({params:n.params.map(W({type:n.type})),meta:P({},n.meta,{[c[rr]]:l,[Ot]:n.Type===d.ImmutableDeclaration}),Type:d.Declaration},n),e([c[n.value],a])};return{[d.Export]:e=>([n,a])=>{let c=e([n,a]),[l]=c.params;return a.exports[l.value]=l,c},[d.Declaration]:s,[d.ImmutableDeclaration]:s,[d.Select]:e=>([n,a],c)=>sn(P({},n,{params:n.params.map(l=>c([l,a]))})),[d.BinaryExpression]:e=>([n,a],c)=>sn(P({},n,{params:n.params.map(l=>c([l,a]))})),[d.Pair]:e=>(n,a)=>{let[c,l]=n,f=c.params.map(g=>a([g,l])),[y,p]=f,{type:v}=y,{value:b}=p;return P({},c,{type:b,value:y.value,Type:d.TypeCast,meta:P({},c.meta,{[tn]:{to:b,from:v}}),params:[y]})},[d.Identifier]:e=>n=>{let[a,c]=n,l=We(c.scopes,a.value);return l?P({},a,{meta:P({},a.meta,l.meta),type:l.type}):a.value==="null"?P({},a,{value:"0",type:"i32",Type:d.Constant}):e(n)},[d.TernaryExpression]:e=>([n,a])=>e([sn(P({},n,{params:[...n.params[1].params,n.params[0]]})),a])}}}}function uo(){return{semantics(){return{"*":s=>function([e,...n],a){return P({},e,{params:e.params.map(l=>a([l,...n]))})}}}}}function po(){return{semantics(){return{[d.Typedef]:s=>([e])=>e,[d.Program]:s=>e=>{let[n,a]=e,{types:c}=a,l=N({[d.Export]:(f,y)=>{let[p]=f.params;return p!=null&&[d.Typedef,d.Struct].includes(p.Type)?y(P({},p,{meta:P({},p.meta,{EXPORTED:!0})})):f},[d.Typedef]:(f,y)=>{let p=0,[v]=f.params,b=[];j({Assignment(w){let L=w.params[1];b.push(L)},Type(){p+=1}})(v);let g=P({},f,{meta:P({},f.meta,{FUNCTION_METADATA:{argumentsCount:p},DEFAULT_ARGUMENTS:b})});return c[f.value]=g,g}})(n);return s([l,a])}}}}}let fo={i64:63,f64:63,i32:31,f32:31},mo={i64:"0xffffffffffff",f64:"0xffffffffffff",i32:"0xffffff",f32:"0xffffff"};function yo(){return{semantics({stmt:s}){return{[d.UnaryExpression]:e=>(n,a)=>{let[c,l]=n,[f,y]=c.params.map(p=>a([p,l]));switch(c.value){case"!":let p=fo[f.type];return a([s`(((${f} >> ${p}) | ((~${f} + 1) >> ${p})) + 1);`,l]);case"~":let v=mo[a([f,l]).type];return a([s`(${f} ^ ${v});`,l]);case"-":if(y.Type===d.Constant)return P({},y,{meta:P({},y.meta,{SIGN:-1})});default:return a([P({},c,{type:y.type,params:[P({},f,{type:y.type}),y],Type:d.BinaryExpression}),l])}}}}}}function ho(){return{semantics(){return{[d.FunctionDeclaration]:s=>([e,n],a)=>{n.scopes=tr(n.scopes,Ct);let c=De(n.scopes),[l,f,y]=e.params,[p,v]=[l,f].map(g=>a([g,n])),b=P({},e,{type:c[Qe].result,meta:P({},e.meta,{[$e]:Object.keys(n.functions).length,[rn]:{argumentsCount:c[Qe].arguments.length,locals:De(n.scopes)}})});return n.functions[e.value]=b,b.params=[p,v,a([y,n])],n.scopes=ao(n.scopes),b},[d.FunctionResult]:s=>([e,n])=>{let a=De(n.scopes);return a[Qe].result=e.type,e},[d.FunctionArguments]:s=>([e,n],a)=>{let c=De(n.scopes);return c[Qe].arguments=[],N({[d.Pair]:(f,y)=>{let[p,v]=f.params,b=a([v,n]);return c[Qe].arguments.push(f),a([P({},f,{value:p.value,type:b.value,params:[],Type:d.Declaration}),n]),P({},f,{params:[p,b]})}})(P({},e,{params:e.params.filter(Boolean)}))},[d.FunctionCall]:s=>([e,n])=>{let{functions:a}=n,c=Object.keys(a).indexOf(e.value);return s([P({},e,{type:a[e.value]!=null?a[e.value].type:null,meta:{[$e]:c},params:e.params.slice(1)}),n])},[d.ReturnStatement]:s=>([e,n],a)=>{let c=De(n.scopes),[l]=e.params.map(p=>a([p,n])),{result:f}=c[Qe];if(l!=null&&l.Type===d.Constant&&ke(l.type)!==ke(f))return P({},e,{type:f,params:[P({},l,{type:f})]});let y=l?l.type:null;return P({},e,{params:[l],type:y})}}}}}function bo(){return{semantics:()=>({[d.Import]:s=>e=>{let[n,a]=e;return N({[d.BinaryExpression]:(c,l)=>{let[f,y]=c.params;if(f.Type!==d.Pair)return c;let[p,v]=f.params;return l(P({},f,{params:[P({},y,{meta:P({},p.meta,{AS:p.value})}),v]}))},[d.Pair]:(c,l)=>{let{types:f,functions:y}=a,[p,v]=c.params;if(f[v.value]!=null){let b=Object.keys(y).length,g=Object.keys(f).indexOf(v.value),w=P({},p,{id:p.value,type:f[v.value].type,meta:P({},p.meta,{[$e]:b,[ft]:g,FUNCTION_METADATA:f[v.value].meta.FUNCTION_METADATA,DEFAULT_ARGUMENTS:f[v.value].meta.DEFAULT_ARGUMENTS})});return y[p.value]=w,P({},c,{params:[w,f[v.value]]})}if(["Table","Memory"].includes(v.value)){let b=v.value==="Memory"?"memories":"tables";a[b].push(p)}else{let b=De(a.scopes),g=nr(b,p.value);io(a.scopes,p.value,P({},p,{meta:{[b[rr]]:g,[Ot]:!0},type:v.type}))}return c}})(n)}})}}function _o(){return{semantics(){let s=e=>([n,a])=>n.type==="bool"?e([P({},n,{type:"i32"}),a]):e([n,a]);return{[d.Identifier]:e=>(n,a)=>{let[c,l]=n;return c.value==="true"||c.value==="false"?a([P({},c,{Type:d.Constant,value:c.value==="true"?"1":"0",type:"i32"}),l]):e(n)},[d.FunctionResult]:e=>([n,a])=>n.type==="bool"?e([P({},n,{type:"i32"}),a]):e([n,a]),[d.Declaration]:s,[d.ImmutableDeclaration]:s}}}}function sr(s,e){let n=[null,e];return function(a){return n[0]=a,s(n)}}function go(s,e){let n={},a=0;for(a;a<s.length;a++)n[s[a]]=e[s[a]];return n}let vo={i32:2,f32:2,i64:3,f64:3},So="i32";function To({stmt:s}){let e=l=>f=>{let[y,p]=f;if(!String(y.type).endsWith("[]"))return l(f);let v=W({type:So,meta:{TYPE_ARRAY:y.type.slice(0,-2)}},y);return l([v,p])};function n(l,f){let y=vo[l.meta.TYPE_ARRAY]||2;return f.Type!==d.Constant||Number(f.value)?s`(${l} + (${f} << ${y}));`:s`(${l});`}function a(l){return!(l.type==null||l.index==null)}function c([l,f]){let y=l.meta.TYPE_ARRAY,p=n(l,f);return{type:y,index:p,TYPE_ARRAY:l.meta.TYPE_ARRAY}}return{[d.Declaration]:e,[d.ImmutableDeclaration]:e,[d.Identifier]:l=>f=>{let[y,p]=f,v=We(p.scopes,y.value);return v&&v.meta.TYPE_ARRAY?l([W(go(["type","meta"],v),y),p]):l(f)},[d.Assignment]:l=>(f,y)=>{let[p,v]=f,[b,g]=p.params;if(b.Type!==d.ArraySubscript)return l(f);let w=sr(y,v),L=c(b.params.map(w)),{type:R,index:F}=L;return I(a(L),`PANIC - Cannot assign to subscript of ${b.value}`),w(s`${R}.store(${F}, ${g});`)},[d.ArraySubscript]:l=>(f,y)=>{let[p,v]=f,b=sr(y,v),g=c(p.params.map(b)),{type:w,index:L,TYPE_ARRAY:R}=g;return a(g)?W({meta:{TYPE_ARRAY:R}},b(s`${w}.load(${L});`)):l(f)},[d.FunctionResult]:e}}function Eo(){return{semantics:To}}let xo=(s,e)=>{let n=s.memories[0];return n&&n.value===e.value};function Ao(){return{semantics({stmt:s}){return{[d.ImmutableDeclaration]:e=>n=>{let[a,c]=n,{scopes:l,memories:f}=c;return!l.length<2&&a.type==="Memory"&&!f.length?(f.push(P({},a,{meta:P({},a.meta,{[Le]:-1})})),f[0]):e(n)},[d.FunctionCall]:e=>(n,a)=>{let[c,l]=n,[f,...y]=c.params,[p={},v={}]=f.params,g={dataSize:a([s`i32.load(0);`,l]),grow:P({},p,{value:"grow_memory",params:y.map(w=>a([w,l])),Type:d.NativeMethod}),size:P({},p,{value:"current_memory",params:[],Type:d.NativeMethod})}[v.value];return f.Type===d.Access&&xo(l,p)&&g?g:e(n)}}}}}let or=s=>{let e=[];for(;;){let n=s&127;s=s>>7;let a=n&64;if(s===0&&!a||s===-1&&a){e.push(n);break}else e.push(n|128)}return e},wo=s=>{let e=[];for(;;){let n=s&127;if(s=s>>>7,s===0){e.push(n);break}e.push(n|128)}return e};let $t=1,Lt=1<<1,Pt=1<<2,It=1<<3,Nt=1<<4,Rt=1<<5,ar=1<<6,Bt=1<<7,kt=1<<8,Mt=1<<9,Ft=1<<10,Dt=1<<11,on=1<<12,Se=4,Co={[$t]:Se,[Lt]:Se*2,[Pt]:Se,[It]:Se*2,[Dt]:Se,[Ft]:Se>>1,[kt]:Se>>2,[Bt]:Se>>2,[Mt]:Se>>1,[Nt]:Se,[Rt]:Se,[ar]:Se},se=!0;var Pe={i32:$t,i64:Lt,f32:Pt,f64:It,anyfunc:Nt,func:Rt,block_type:ar,i8:Bt,u8:kt,i16:Mt,u16:Ft,u32:Dt,u64:on,set:(s,e,n,a)=>{switch(s){case $t:return n.setInt32(e,a,se);case Lt:return n.setInt64(e,a,se);case Pt:return n.setFloat32(e,a,se);case It:return n.setFloat64(e,a,se);case Nt:return n.setUint32(e,a,se);case Rt:return n.setUint32(e,a,se);case Bt:return n.setInt8(e,a,se);case kt:return n.setUint8(e,a,se);case Mt:return n.setInt16(e,a,se);case Ft:return n.setUint16(e,a,se);case Dt:return n.setUint32(e,a,se);case on:return n.setUint64(e,a,se);default:return n.setUint8(e,a,se)}},get:(s,e,n)=>{switch(s){case $t:return n.getInt32(e,se);case Lt:return n.getInt64(e,se);case Pt:return n.getFloat32(e,se);case It:return n.getFloat64(e,se);case Nt:return n.getUint32(e,se);case Rt:return n.getUint32(e,se);case Bt:return n.getInt8(e,se);case kt:return n.getUint8(e,se);case Mt:return n.getInt16(e,se);case Ft:return n.getUint16(e,se);case Dt:return n.getUint32(e,se);case on:return n.getUint64(e,se);default:return n.getUint8(e,se)}},sizeof:Co},T=Pe.i32,$=Pe.i64,C=Pe.f32,oe=Pe.f64,ce=Pe.u8,an=Pe.u32,ir=Pe.set,cn=Pe.sizeof;class le{constructor(){this.data=[],this.size=0}push(e,n,a){let c=0;switch(e){case"varuint7":case"varuint32":case"varint7":case"varint1":{n=wo(n),c=n.length,I(c,`Cannot write a value of size ${c}`);break}case"varint32":{n=or(n),c=n.length,I(c,`Cannot write a value of size ${c}`);break}case"varint64":{n=or(n),c=n.length,I(c,`Cannot write a value of size ${c}`);break}default:c=cn[e],I(c,`Cannot write a value of size ${c}, type ${e}`)}return this.data.push({type:e,value:n,debug:a}),this.size+=c,this}buffer(e=new ArrayBuffer(this.size)){let n=new DataView(e),a=0;return this.data.forEach(({type:c,value:l})=>{Array.isArray(l)?l.forEach(f=>ir(ce,a++,n,f)):(ir(c,a,n,l),a+=cn[c])}),e}write(e){return e&&(this.data=this.data.concat(e.data),this.size+=e.size),this}}function*Oo(s,e){let n=0,a=0,c=0,l=e;for(;;){let y=s.getUint8(l,!0);if(n|=(y&127)<<c,l+=1,!(y&128))break;c+=7}let f=0;for(;a<n;){for(f=0,c=0;;){let y=s.getUint8(l,!0);if(f|=(y&127)<<c,l+=1,!(y&128))break;c+=7}a+=1,yield f}}function cr(s){let e=new le,n=new le;n.push("varuint32",s.length,s);let a=0;for(a=0;a<s.length;a++)n.push("varuint32",s.codePointAt(a),s[a]);return e.write(n),e}let $o={["\\0"]:0,["\\a"]:7,["\\b"]:8,["\\t"]:9,["\\n"]:10,["\\v"]:11,["\\f"]:12,["\\r"]:13,["\\'"]:39},Lo={i64:8,f64:8,i32:4,f32:4};function Po(s,e){let n=new le,a=Pe[e];return s.forEach(c=>{n.push(a,c,String(c))}),n}function Io(){let s=0;return{semantics:({stmt:e})=>({[d.StaticDeclaration]:n=>([a,c],l)=>{let{userTypes:f,statics:y}=c,p=String(a.type).slice(0,-2),v=Lo[p],b=a.params.reduce((w,L,R)=>{let F=l([L,c]);return w.OBJECT_SIZE+=v,w.TYPE_OBJECT[R]=R*v,w.OBJECT_KEY_TYPES[R]=p,w.VALUES.push(Number(F.value)),w},{OBJECT_SIZE:0,TYPE_OBJECT:{},OBJECT_KEY_TYPES:{},VALUES:[],STATIC:p}),g=`__auto_gen_${a.value}_${s}`;return s+=1,f[g]=P({},a,{value:g,Type:d.Type,meta:b,params:[]}),y[g]=Po(b.VALUES,p),l([P({},a,{meta:b,type:g,Type:d.ImmutableDeclaration,params:[P({},a.params[0],{value:g,Type:d.StaticValueList})]}),c])},[d.ArraySubscript]:n=>([a,c],l)=>{let[f,y]=a.params.map(v=>l([v,c]));if(!f.meta.STATIC)return n([a,c]);let p={i32:2,f32:2,i64:3,f64:3}[f.meta.STATIC];return l([e`${f.meta.STATIC}.load(${f} + (${y} << ${p}));`,c])},[d.CharacterLiteral]:n=>([a,c],l)=>{let f=$o[a.value]||a.value.codePointAt(0);return l([P({},a,{Type:"Constant",type:"i32",value:String(f)}),c])},[d.StringLiteral]:n=>a=>{let[c,l]=a,{statics:f}=l,{value:y}=c;return y in f||(f[y]=cr(y)),c}})}}function No(){return{semantics(){return{[d.ImmutableDeclaration]:s=>function(e){let[n,a]=e;return!a.locals&&n.type==="Table"?P({},n,{meta:P({},n.meta,{[Le]:-1})}):s(e)},[d.Identifier]:s=>function(e){let[n,a]=e,{functions:c,table:l,scopes:f}=a;return We(f,n.value)||!c[n.value]?s(e):(l[n.value]==null&&(l[n.value]=c[n.value]),P({},n,{type:"i32",meta:{[$e]:c[n.value].meta[$e]},value:Object.keys(l).indexOf(n.value),Type:d.FunctionPointer}))},[d.FunctionResult]:s=>(e,n)=>{let[a,c]=e,{types:l}=c;return l[a.type]?s([W({type:"i32",meta:{ALIAS:a.type},params:a.params.map(f=>n([f,c]))},a),c]):s(e)},[d.FunctionCall]:s=>function(e,n){let[a,c]=e,{scopes:l,types:f}=c,y=We(l,a.value);if(!y)return s(e);let p=f[y.type],v=Object.keys(f).indexOf(y.type),b=[...a.params.slice(1),P({},y,{Type:d.Identifier})].map(g=>n([g,c]));return P({},a,{meta:P({},a.meta,y.meta,{[ft]:v}),type:p!=null?p.type:a.type,params:b,Type:d.IndirectFunctionCall})}}}}}let Ut="i32",Ro={i64:8,f64:8,i32:4,f32:4,["__DIRECT_ADDRESS__"]:4},Bo=s=>{let e={},n={},a=0;return j({[d.Pair]:c=>{let[l]=c.params,f=l.value,y=c.params[1].value;I(e[f]==null,`Duplicate key ${f} not allowed in object type`),n[f]=`${l.Type==="AddressOf"?"&":""}${y}`,e[f]=a,a+=Ro[y]||4}})(s),[e,a,n]},ko=s=>(e,n)=>{let a=s`throw;`,c={load:W({range:n.range},s`i32.load(${a}, ${a});`),store:F=>W({range:n.range},s`i32.store(${a}, ${F});`),offset:a,type:"void"};if(e.meta.STRUCT_TYPE==null)return c;let l=e.meta.STRUCT_TYPE,f=l.meta.TYPE_OBJECT,y=l.meta.OBJECT_KEY_TYPES,p=f[n.value];if(p==null)return c;let v=y[n.value],b=v[0]==="&",g=p?s`(${e} + ${p});`:s`(${e});`,w=null,L=null;v!=null&&typeof v=="object"&&(w=v,v=Ut),String(v).endsWith("[]")&&(L=v.slice(0,-2).replace("&",""),v="i32");let R=W({range:e.range,meta:{STRUCT_TYPE:w,TYPE_ARRAY:L}});return{offset:g,type:v,store:F=>R(s`${v}.store(${g}, ${F});`),load:R(b?g:s`${v}.load(${g});`)}};function Mo(){return{semantics({stmt:s}){let e=ko(s);function n(c,l){let[f,y]=c,[p,v]=f.params,[b,g]=p.params,w=e(l([b,y]),g);return l([w.store(v),y])}function a(c,l){let[f,y]=c,[p,v]=f.params,b=l([p,y]),g=[];j({[d.Identifier]:(L,R)=>{let F=e(b,L);g.push({field:F,value:L})},[d.Pair]:(L,R)=>{let[F,z]=L.params,X=e(b,F);g.push({field:X,value:z})},[d.Spread]:(L,R)=>{let F=l([L.params[0],y]);Object.keys(F.meta.TYPE_OBJECT).forEach(z=>{let X=e(b,{value:z,type:null,range:F.range}),Q=e(F,{value:z,type:null,range:F.range});g.push({field:X,value:Q.load})})}})(v);let w=g.filter(({field:L})=>L!=null).map(L=>l([L.field.store(L.value),y]));return P({},p,{Type:d.Block,params:w})}return{[d.Struct]:c=>([l,f],y)=>{let{userTypes:p,aliases:v}=f,[b]=l.params,g=P({},l,{meta:P({},l.meta,{TYPE_OBJECT:{},OBJECT_SIZE:0,OBJECT_KEY_TYPES:{}})}),w=()=>{v[l.value]=b.value},L=(F,z)=>{let[X,Q,Ce]=Bo(F);g.meta.TYPE_OBJECT=P({},g.meta.TYPE_OBJECT,X),g.meta.OBJECT_SIZE+=Q,g.meta.OBJECT_KEY_TYPES=P({},g.meta.OBJECT_KEY_TYPES,Ce)};return{[d.Type]:w,[d.Identifier]:w,[d.ObjectLiteral]:()=>{L(l),p[g.value]=g},[d.UnionType]:()=>{j({[d.ObjectLiteral]:L,[d.ArrayType]:F=>{g.meta.TYPE_ARRAY=F.type.slice(0,-2)},[d.Identifier]:F=>{let z=p[y([F,f]).value];g.meta.TYPE_OBJECT=P({},g.meta.TYPE_OBJECT,z.meta.TYPE_OBJECT),g.meta.OBJECT_SIZE=Math.max(g.meta.OBJECT_SIZE,z.meta.OBJECT_SIZE),g.meta.OBJECT_KEY_TYPES=P({},g.meta.OBJECT_KEY_TYPES,z.meta.OBJECT_KEY_TYPES)}})(b),p[g.value]=g}}[b.Type](),g.meta.OBJECT_KEY_TYPES=Object.entries(g.meta.OBJECT_KEY_TYPES).reduce((F,[z,X])=>(F[z]=p[X]||X,F),{}),g},[d.DeclType]:c=>(l,f)=>{let[y,p]=l,{aliases:v}=p;return v[y.value]?f([W({value:v[y.value],type:v[y.value]},y),p]):c(l)},[d.FunctionResult]:c=>(l,f)=>{let[y,p]=l,{userTypes:v,aliases:b}=p;return b[y.type]?f([W({type:b[y.type]},y),p]):v[String(y.type)]?c([W({type:Ut,meta:{STRUCT_TYPE:v[y.type]},params:y.params.map(g=>f([g,p]))},y),p]):c(l)},[d.Identifier]:c=>l=>{let[f,y]=l,{userTypes:p,scopes:v}=y,b=We(v,f.value);return b&&p[b.type]?P({},f,{meta:P({},f.meta,b.meta,p[b.type].meta,{STRUCT_TYPE:p[b.type]}),type:Ut}):c(l)},[d.Access]:function(c){return(l,f)=>{let[y,p]=l,[v,b]=y.params,g=e(f([v,p]),b);return f([g.load,p])}},[d.Assignment]:c=>(l,f)=>{let[y]=l,[p,v]=y.params;return p.Type===d.Access?n(l,f):v.Type===d.ObjectLiteral?a(l,f):c(l)},[d.ArraySubscript]:c=>(l,f)=>{let[y,p]=l,v=c(l);if(p.userTypes[v.meta.TYPE_ARRAY]==null)return v;let[b,g]=y.params.map(w=>f([w,p]));return f([W({type:Ut,meta:{STRUCT_TYPE:p.userTypes[v.meta.TYPE_ARRAY]}},s`(${b} + (${g} * sizeof(${v.meta.TYPE_ARRAY})));`),p])}}}}}function Fo(){return{semantics(){return{[d.FunctionCall]:s=>(e,n)=>{let[a,c]=e,[l,...f]=a.params;if(l.Type===d.Access&&l.params[0]&&l.params[0].Type===d.Type){let[y,p]=l.params;return W({value:`${y.value}.${p.value}`,type:y.value,params:f.map(v=>n([v,c])),Type:d.NativeMethod},a)}return s(e)},[d.Unreachable]:s=>([e])=>W({value:"unreachable",params:[],Type:d.NativeMethod},e)}}}}function Do(){return{grammar:Kn,semantics(){return{[d.FunctionDeclaration]:s=>e=>{let[n,a]=e,[c]=n.params,l=[];return j({Assignment:f=>{let[,y]=f.params;l.push(y)}})(c),s([P({},n,{meta:P({},n.meta,{DEFAULT_ARGUMENTS:l})}),a])},[d.FunctionCall]:s=>e=>{let[n,a]=e,{functions:c}=a,[l,...f]=n.params,y=c[l.value];if(!y)return s(e);let p=y.meta.FUNCTION_METADATA.argumentsCount,v=f.length,b=p-v;return b>0?s([P({},n,{params:[...n.params,...y.meta.DEFAULT_ARGUMENTS.slice(b-1)]}),a]):s(e)}}}}}let Uo={i64:8,f64:8,i32:4,f32:4};function jo(){return{semantics(){return{[d.FunctionCall]:s=>e=>{let[n,a]=e;if(n.value!=="sizeof")return s(e);let{scopes:c,userTypes:l,functions:f}=a,[,y]=n.params,p=We(c,y.value),{type:v=""}=p||{},b=l[y.value]||l[v],g=f[y.value];if(b!=null){let L=b.meta[co];return I(L,"Object size information is missing"),P({},n,{value:L,params:[],type:"i32",Type:d.Constant})}let w=p||g;return P({},n,{value:Uo[String(w?w.type:y.value)],type:"i32",params:[],Type:d.Constant})}}}}}let zo=()=>[uo().semantics,lo().semantics,bo().semantics,po().semantics,yo().semantics,ho().semantics,_o().semantics,Eo().semantics,Ao().semantics,Io().semantics,No().semantics,Mo().semantics,Fo().semantics,jo().semantics,Do().semantics];function ln(s,e,n){let a=[...zo(),...e],c=qs(a.map(R=>R(n))),l={functions:{},types:{},userTypes:{},table:{},hoist:[],statics:{},path:[],scopes:tr([],Le),memories:[],tables:[],aliases:{},exports:{}},f=A(c)([s,l]),{functions:y,scopes:p,types:v,userTypes:b,statics:g,hoist:w,exports:L}=l;return P({},f,{meta:P({},f.meta,{[nn]:{functions:y,globals:p[0],types:v,userTypes:b,statics:g,exports:L}}),params:[...f.params,...w]})}function we(s,e,n,a,c){let l=n.start.line,f=n.start.col,y=n.end.col,p=n.end.sourceLine,v=new Array(y-f+1).join("^").padStart(n.start.col-1," ");return`
`+p+`
`+v+` ${e}
`+s+`
  at ${c} (${a}:${l}:${f})`}let k={},Go=[],un={},x=null,S=(s,e,n,a,c,l,f)=>{let y={result:s,first:e,second:n,size:a,code:c,name:l,text:f};return k[l]=y,Go[c]=y,un[f]=y,y};S(x,x,x,0,0,"Unreachable","unreachable"),S(x,x,x,0,1,"Nop","nop"),S(x,x,x,0,2,"Block","block"),S(x,x,x,0,3,"Loop","loop"),S(x,x,x,0,4,"If","if"),S(x,x,x,0,5,"Else","else"),S(x,x,x,0,6,"Try","try"),S(x,x,x,0,7,"Catch","catch"),S(x,x,x,0,8,"Throw","throw"),S(x,x,x,0,9,"Rethrow","rethrow"),S(x,x,x,0,10,"CatchAll","catch_all"),S(x,x,x,0,11,"End","end"),S(x,x,x,0,12,"Br","br"),S(x,x,x,0,13,"BrIf","br_if"),S(x,x,x,0,14,"BrTable","br_table"),S(x,x,x,0,15,"Return","return"),S(x,x,x,0,16,"Call","call"),S(x,x,x,0,17,"CallIndirect","call_indirect"),S(x,x,x,0,26,"Drop","drop"),S(x,x,x,0,27,"Select","select"),S(x,x,x,0,32,"GetLocal","get_local"),S(x,x,x,0,33,"SetLocal","set_local"),S(x,x,x,0,34,"TeeLocal","tee_local"),S(x,x,x,0,35,"GetGlobal","get_global"),S(x,x,x,0,36,"SetGlobal","set_global"),S(T,T,x,4,40,"i32Load","i32.load"),S($,T,x,8,41,"i64Load","i64.load"),S(C,T,x,4,42,"f32Load","f32.load"),S(oe,T,x,8,43,"f64Load","f64.load"),S(T,T,x,1,44,"i32Load8S","i32.load8_s"),S(T,T,x,1,45,"i32Load8U","i32.load8_u"),S(T,T,x,2,46,"i32Load16S","i32.load16_s"),S(T,T,x,2,47,"i32Load16U","i32.load16_u"),S($,T,x,1,48,"i64Load8S","i64.load8_s"),S($,T,x,1,49,"i64Load8U","i64.load8_u"),S($,T,x,2,50,"i64Load16S","i64.load16_s"),S($,T,x,2,51,"i64Load16U","i64.load16_u"),S($,T,x,4,52,"i64Load32S","i64.load32_s"),S($,T,x,4,53,"i64Load32U","i64.load32_u"),S(x,T,T,4,54,"i32Store","i32.store"),S(x,T,$,8,55,"i64Store","i64.store"),S(x,T,C,4,56,"f32Store","f32.store"),S(x,T,C,8,57,"f64Store","f64.store"),S(x,T,T,1,58,"i32Store8","i32.store8"),S(x,T,T,2,59,"i32Store16","i32.store16"),S(x,T,$,1,60,"i64Store8","i64.store8"),S(x,T,$,2,61,"i64Store16","i64.store16"),S(x,T,$,4,62,"i64Store32","i64.store32"),S(T,x,x,0,63,"CurrentMemory","current_memory"),S(T,T,x,0,64,"GrowMemory","grow_memory"),S(T,x,x,0,65,"i32Const","i32.const"),S($,x,x,0,66,"i64Const","i64.const"),S(C,x,x,0,67,"f32Const","f32.const"),S(oe,x,x,0,68,"f64Const","f64.const"),S(T,T,x,0,69,"i32Eqz","i32.eqz"),S(T,T,T,0,70,"i32Eq","i32.eq"),S(T,T,T,0,71,"i32Ne","i32.ne"),S(T,T,T,0,72,"i32LtS","i32.lt_s"),S(T,T,T,0,73,"i32LtU","i32.lt_u"),S(T,T,T,0,74,"i32GtS","i32.gt_s"),S(T,T,T,0,75,"i32GtU","i32.gt_u"),S(T,T,T,0,76,"i32LeS","i32.le_s"),S(T,T,T,0,77,"i32LeU","i32.le_u"),S(T,T,T,0,78,"i32GeS","i32.ge_s"),S(T,T,T,0,79,"i32GeU","i32.ge_u"),S(T,$,x,0,80,"i64Eqz","i64.eqz"),S(T,$,$,0,81,"i64Eq","i64.eq"),S(T,$,$,0,82,"i64Ne","i64.ne"),S(T,$,$,0,83,"i64LtS","i64.lt_s"),S(T,$,$,0,84,"i64LtU","i64.lt_u"),S(T,$,$,0,85,"i64GtS","i64.gt_s"),S(T,$,$,0,86,"i64GtU","i64.gt_u"),S(T,$,$,0,87,"i64LeS","i64.le_s"),S(T,$,$,0,88,"i64LeU","i64.le_u"),S(T,$,$,0,89,"i64GeS","i64.ge_s"),S(T,$,$,0,90,"i64GeU","i64.ge_u"),S(T,C,C,0,91,"f32Eq","f32.eq"),S(T,C,C,0,92,"f32Ne","f32.ne"),S(T,C,C,0,93,"f32Lt","f32.lt"),S(T,C,C,0,94,"f32Gt","f32.gt"),S(T,C,C,0,95,"f32Le","f32.le"),S(T,C,C,0,96,"f32Ge","f32.ge"),S(T,C,C,0,97,"f64Eq","f64.eq"),S(T,C,C,0,98,"f64Ne","f64.ne"),S(T,C,C,0,99,"f64Lt","f64.lt"),S(T,C,C,0,100,"f64Gt","f64.gt"),S(T,C,C,0,101,"f64Le","f64.le"),S(T,C,C,0,102,"f64Ge","f64.ge"),S(T,T,x,0,103,"i32Clz","i32.clz"),S(T,T,x,0,104,"i32Ctz","i32.ctz"),S(T,T,x,0,105,"i32Popcnt","i32.popcnt"),S(T,T,T,0,106,"i32Add","i32.add"),S(T,T,T,0,107,"i32Sub","i32.sub"),S(T,T,T,0,108,"i32Mul","i32.mul"),S(T,T,T,0,109,"i32DivS","i32.div_s"),S(T,T,T,0,110,"i32DivU","i32.div_u"),S(T,T,T,0,111,"i32RemS","i32.rem_s"),S(T,T,T,0,112,"i32RemU","i32.rem_u"),S(T,T,T,0,113,"i32And","i32.and"),S(T,T,T,0,114,"i32Or","i32.or"),S(T,T,T,0,115,"i32Xor","i32.xor"),S(T,T,T,0,116,"i32Shl","i32.shl"),S(T,T,T,0,117,"i32ShrS","i32.shr_s"),S(T,T,T,0,118,"i32ShrU","i32.shr_u"),S(T,T,T,0,119,"i32Rotl","i32.rotl"),S(T,T,T,0,120,"i32Rotr","i32.rotr"),S($,$,x,0,121,"i64Clz","i64.clz"),S($,$,x,0,122,"i64Ctz","i64.ctz"),S($,$,x,0,123,"i64Popcnt","i64.popcnt"),S($,$,$,0,124,"i64Add","i64.add"),S($,$,$,0,125,"i64Sub","i64.sub"),S($,$,$,0,126,"i64Mul","i64.mul"),S($,$,$,0,127,"i64DivS","i64.div_s"),S($,$,$,0,128,"i64DivU","i64.div_u"),S($,$,$,0,129,"i64RemS","i64.rem_s"),S($,$,$,0,130,"i64RemU","i64.rem_u"),S($,$,$,0,131,"i64And","i64.and"),S($,$,$,0,132,"i64Or","i64.or"),S($,$,$,0,133,"i64Xor","i64.xor"),S($,$,$,0,134,"i64Shl","i64.shl"),S($,$,$,0,135,"i64ShrS","i64.shr_s"),S($,$,$,0,136,"i64ShrU","i64.shr_u"),S($,$,$,0,137,"i64Rotl","i64.rotl"),S($,$,$,0,138,"i64Rotr","i64.rotr"),S(C,C,C,0,139,"f32Abs","f32.abs"),S(C,C,C,0,140,"f32Neg","f32.neg"),S(C,C,C,0,141,"f32Ceil","f32.ceil"),S(C,C,C,0,142,"f32Floor","f32.floor"),S(C,C,C,0,143,"f32Trunc","f32.trunc"),S(C,C,C,0,144,"f32Nearest","f32.nearest"),S(C,C,C,0,145,"f32Sqrt","f32.sqrt"),S(C,C,C,0,146,"f32Add","f32.add"),S(C,C,C,0,147,"f32Sub","f32.sub"),S(C,C,C,0,148,"f32Mul","f32.mul"),S(C,C,C,0,149,"f32Div","f32.div"),S(C,C,C,0,150,"f32Min","f32.min"),S(C,C,C,0,151,"f32Max","f32.max"),S(C,C,C,0,152,"f32Copysign","f32.copysign"),S(C,C,C,0,153,"f32Abs","f64.abs"),S(C,C,C,0,154,"f32Neg","f64.neg"),S(C,C,C,0,155,"f32Ceil","f64.ceil"),S(C,C,C,0,156,"f32Floor","f64.floor"),S(C,C,C,0,157,"f32Trunc","f64.trunc"),S(C,C,C,0,158,"f32Nearest","f64.nearest"),S(C,C,C,0,159,"f32Sqrt","f64.sqrt"),S(oe,oe,oe,0,160,"f64Add","f64.add"),S(oe,oe,oe,0,161,"f64Sub","f64.sub"),S(oe,oe,oe,0,162,"f64Mul","f64.mul"),S(oe,oe,oe,0,163,"f64Div","f64.div"),S(oe,oe,oe,0,164,"f64Min","f64.min"),S(oe,oe,oe,0,165,"f64Max","f64.max"),S(oe,oe,oe,0,166,"f64Copysign","f64.copysign"),S(T,$,x,0,167,"i32Wrapi64","i32.wrap/i64"),S(T,C,x,0,168,"i32TruncSf32","i32.trunc_s/f32"),S(T,C,x,0,169,"i32TruncUf32","i32.trunc_u/f32"),S(T,C,x,0,170,"i32TruncSf64","i32.trunc_s/f64"),S(T,C,x,0,171,"i32TruncUf64","i32.trunc_u/f64"),S($,T,x,0,172,"i64ExtendSi32","i64.extend_s/i32"),S($,T,x,0,173,"i64ExtendUi32","i64.extend_u/i32"),S($,C,x,0,174,"i64TruncSf32","i64.trunc_s/f32"),S($,C,x,0,175,"i64TruncUf32","i64.trunc_u/f32"),S($,C,x,0,176,"i64TruncSf64","i64.trunc_s/f64"),S($,C,x,0,177,"i64TruncUf64","i64.trunc_u/f64"),S(C,T,x,0,178,"f32ConvertSi32","f32.convert_s/i32"),S(C,T,x,0,179,"f32ConvertUi32","f32.convert_u/i32"),S(C,$,x,0,180,"f32ConvertSi64","f32.convert_s/i64"),S(C,$,x,0,181,"f32ConvertUi64","f32.convert_u/i64"),S(C,C,x,0,182,"f32Demotef64","f32.demote/f64"),S(C,T,x,0,183,"f64ConvertSi32","f64.convert_s/i32"),S(C,T,x,0,184,"f64ConvertUi32","f64.convert_u/i32"),S(C,$,x,0,185,"f64ConvertSi64","f64.convert_s/i64"),S(C,$,x,0,186,"f64ConvertUi64","f64.convert_u/i64"),S(C,C,x,0,187,"f64Promotef32","f64.promote/f32"),S(T,C,x,0,188,"i32Reinterpretf32","i32.reinterpret/f32"),S($,C,x,0,189,"i64Reinterpretf64","i64.reinterpret/f64"),S(C,T,x,0,190,"f32Reinterpreti32","f32.reinterpret/i32"),S(C,$,x,0,191,"f32Reinterpreti64","f64.reinterpret/i64");let lr=(s,e)=>{let n=s[0];return["i32","bool"].includes(s)&&e==="i64"?k.i32Wrapi64:s==="i64"&&["i32","bool"].includes(e)?k.i64ExtendSi32:s==="f32"&&e==="f64"?k.f32Demotef64:s==="f64"&&e==="f32"?k.f64Promotef32:k[s+(n==="f"?"ConvertS":"TruncS")+e]},ur=({type:s,value:e})=>({"+":k[String(s)+"Add"],"-":k[String(s)+"Sub"],"*":k[String(s)+"Mul"],"/":k[String(s)+"DivS"]||k[String(s)+"Div"],"%":k[String(s)+"RemS"]||k[String(s)+"RemU"],"==":k[String(s)+"Eq"],"!=":k[String(s)+"Ne"],">":k[String(s)+"Gt"]||k[String(s)+"GtS"],"<":k[String(s)+"Lt"]||k[String(s)+"LtS"],"<=":k[String(s)+"Le"]||k[String(s)+"LeS"],">=":k[String(s)+"Ge"]||k[String(s)+"GeS"],"?":k.If,":":k.Else,"&":k[String(s)+"And"],"|":k[String(s)+"Or"],"^":k[String(s)+"Xor"],">>":k[String(s)+"ShrS"],">>>":k[String(s)+"ShrU"],"<<":k[String(s)+"Shl"]})[e],Ke=127,He=126,Xe=125,Ze=124,pr=112,fr=96,Yo={i32:Ke,i64:He,f32:Xe,f64:Ze},jt=s=>{switch(s){case He:return"i64";case Xe:return"f32";case Ze:return"f64";case fr:return"func";case pr:return"anyfunc";case Ke:default:return"i32"}},pn=s=>{let e={};return j({[d.Pair]:({params:n})=>{let[{value:a},{value:c}]=n;e[a]=parseInt(c)}})(s),e},qo=s=>{let e=s.value||"??",n=s.type,a=ur({value:e,type:n||"i32"});return n?a.text:a.text.replace("i32","??")},mr=s=>{let e=[];return j({[d.Pair]:(n,a)=>{e.push(`${n.params[0].value} ${n.params[1].value}`)},[d.Type]:n=>{e.push(n.value)}})(s),e.length?" param("+e.join(" ")+")":""},yr=s=>s==null?"":" (result "+(s.type||"??")+")",hr=s=>{let[e,n]=s.params;return"(type "+s.value+` (func${mr(e)}${yr(n)}))`},Me=(s,e,{value:n,params:a})=>{a.filter(Boolean).length?(s(`(${n}`,2),a.forEach(e),s(")",0,-2)):s(`(${n})`,0,0)},Jo=s=>({[d.Import]:(e,n)=>{let[a,c]=e.params;j({[d.Pair]:({params:l},f)=>{let{value:y}=l[0],p=l[1];if(p.value==="Memory"){let v=pn(p);s(`(import "${c.value}" "${y}" (memory ${v.initial}${v.max?v.max:""}))`)}else s(`(import "${c.value}" "${y}" ${hr(p)})`)},[d.Identifier]:(l,f)=>{let{value:y}=l;s(`(import "${c.value}" "${y}" (type ??))`)}})(a)},[d.Export]:(e,n)=>{s("(export",2),e.params.forEach(n),s(")",0,-2)},[d.GenericType]:(e,n)=>{s(";; Pseudo type",0,0),s("(type-generic "+e.value+")",0,0)},[d.FunctionCall]:({value:e,params:n},a)=>{Me(s,a,{value:`call ${e}`,params:n})},[d.Block]:({params:e},n)=>{Me(s,n,{value:"block",params:e})},[d.NativeMethod]:(e,n)=>{Me(s,n,e)},[d.BinaryExpression]:(e,n)=>{let a=qo(e);Me(s,n,{value:a,params:e.params})},[d.ArraySubscript]:({params:e},n)=>{s(";; unparsed",0,0),Me(s,n,{value:"subscript",params:e})},[d.Typedef]:(e,n)=>{s(hr(e))},[d.Struct]:(e,n)=>{s(";; Pseudo struct type",0,0),Me(s,n,{value:"type-struct "+e.value,params:e.params})},[d.Identifier]:e=>{let n=e.meta[Le]!=null?"global":"local";s(`(get_${n} ${e.value})`)},[d.Constant]:e=>{s(`(${String(e.type)}.const ${e.value})`)},[d.FunctionPointer]:e=>{s(`(${String(e.type)}.table_pointer ${e.value})`)},[d.FunctionDeclaration]:(e,n)=>{let[a,c,...l]=e.params;s(`(func ${e.value}${mr(a)}${yr(c)}`,2),l.forEach(n),s(")",0,-2)},[d.ReturnStatement]:({params:e},n)=>{Me(s,n,{value:"return",params:e})},[d.Declaration]:(e,n)=>{s("(local "+e.value+" "+String(e.type),2,0),e.params.forEach(n),s(")",0,-2)},[d.ImmutableDeclaration]:(e,n)=>{let a=e.meta[Le]!=null?"global":"local";if(e.type==="Memory"){let c=pn(e);s(`(memory ${c.initial}${c.max?` ${c.max}`:""})`)}else s(`(${a} `+e.value+" "+String(e.type),2,0),e.params.forEach(n),s(")",0,-2)},[d.StringLiteral]:e=>{s(`; string "${e.value}"`,0,0),s("(i32.const ??)",0,0)},[d.Type]:e=>{s(e.value)},[d.TypeCast]:(e,n)=>{let a=e.params[0],c=lr(String(e.type),a.type);s("("+c.text,2),e.params.forEach(n),s(")",0,-2)},[d.Access]:({params:e},n)=>{s(";; unparsed",0,0),Me(s,n,{value:"access",params:e})},[d.MemoryAssignment]:(e,n)=>{s("("+String(e.type)+".store",2,0),e.params.forEach(n),s(")",0,-2)},[d.Assignment]:(e,n)=>{let[a,...c]=e.params,l=a.meta[Le]!=null?"global":"local";s(`(set_${l} ${a.value}`,2),[d.ArraySubscript,d.Access].includes(a.Type)&&n(a),c.forEach(n),s(")",0,-2)},[d.TernaryExpression]:(e,n)=>{let[a,c,l]=e.params;s("(select",2),n(a),n(c),n(l),s(")",0,-2)},[d.IfThenElse]:(e,n)=>{let[a,c,...l]=e.params;s("(if",2),n(a),s("(then",2),n(c),s(")",0,-2),l.length>0&&(s("(else",2),l.forEach(n),s(")",0,-2)),s(")",0,-2)},[d.ObjectLiteral]:(e,n)=>{}}),dr=s=>{if(s==null)return"";let e=0,n=[],a=[];return j(Jo((f,y=0,p=0)=>{e+=p,a.push(f),n.push(e+f.length),e+=y}))(s),a.reduce((f,y,p)=>(f+=y.padStart(n[p]," ")+`
`,f),"")},br=wt((s,e)=>{let n=e.meta[Ct],a=e.meta[Le],c=n!=null?n:a;I(c!=null,`Undefined index for scope Operation. Possibly missing metadata. op: ${JSON.stringify(s)} node: ${dr(e)}`);let l=n!=null?s+"Local":s+"Global",f=[Number(c)];return{kind:k[l],params:f,debug:`${e.value}<${e.meta.ALIAS||e.type}>`}}),Vo=s=>{switch(s){case ye.f32:return Xe;case ye.f64:return Ze;case ye.i64:return He;case ye.i32:default:return Ke}},mt=s=>typeof s=="string"&&ye[s]!=null,_r=s=>({mutable:s.meta[Ot]?0:1,type:Vo(s.type)}),Wo=br("Set"),gr=br("Get"),zt="global";function fn(s,{filename:e}){let n=s.meta[nn];if(n==null)throw new Error("Missing AST metadata!");let{types:a,functions:c,userTypes:l}=n,f=[];j({[d.Import]:(p,v)=>{j({[d.BinaryExpression]:(b,g)=>{let[w,L]=b.range;f.push(we("Using an 'as' import without a type.","A type for original import "+b.params[0].value+" is not defined nor could it be inferred.",{start:w,end:L},e,zt))},[d.Identifier]:(b,g)=>{let[w,L]=b.range;f.push(we("Infered type not supplied.","Looks like you'd like to infer a type, but it was never provided by a linker. Non-concrete types cannot be compiled.",{start:w,end:L},e,zt))},[d.Pair]:(b,g)=>{let w=b.params[1];if(!mt(w.value)&&a[w.value]==null){let[L,R]=w.range;f.push(we(`Undefined Type ${w.value}`,`Invalid Import. ${w.value} type does not exist`,{start:L,end:R},e,zt))}}})(p)},[d.Struct]:(p,v)=>{},[d.ImmutableDeclaration]:(p,v)=>{},[d.Declaration]:(p,v)=>{let[b,g]=p.range;!mt(p.type)&&!a[p.type]&&!l[p.type]&&f.push(we(`Unknown type used in a declaration, "${String(p.type)}"`,"Variables must be assigned with a known type.",{start:b,end:g},e,zt))},[d.FunctionDeclaration]:(p,v)=>{let b=`${p.value}()`;j({[d.Declaration]:(g,w)=>{let[L,R]=g.range;!mt(g.type)&&!a[g.type]&&!l[g.type]&&f.push(we(`Unknown type used in a declartion, "${String(g.type)}"`,"Variables must be assigned with a known type.",{start:L,end:R},e,b))},[d.Assignment]:g=>{let[w]=g.params,[L,R]=g.range;w.meta[Ot]&&f.push(we(`Cannot reassign a const variable ${w.value}`,"const variables cannot be reassigned, use let instead.",{start:L,end:R},e,b))},[d.ArraySubscript]:g=>{let[w]=g.params,[L,R]=g.range;f.push(we("Invalid subscript target",`Expected array type for ${w.value}, received ${w.type}`,{start:L,end:R},e,b))},[d.NativeMethod]:(g,w)=>{let{value:L}=g,[R={},F]=g.params,[z,X]=g.range;R.value==="unreachable"&&(L.includes("store")||L.includes("load"))&&f.push(we("Cannot generate property access",`Cannot assign "${F.value}". Key is "${R.value}"`,{start:z,end:X},e,b))},[d.ReturnStatement]:(g,w)=>{if(g.params.map(w),p.type==null)return;let[L]=g.params,[R]=g.range,F=L!=null?L.range[1]:g.range[1],z=g.type;ke(z)!==ke(p.type)&&f.push(we("Missing return value","Inconsistent return value. Expected "+p.type+" received "+String(z),{start:R,end:F},e,b))},[d.FunctionCall]:(g,w)=>{if(c[g.value]==null){let[L,R]=g.range;f.push(we("Undefined function reference",`${g.value} is not defined.`,{start:L,end:R},e,b))}},[d.IndirectFunctionCall]:(g,w)=>{let L=g.params[g.params.length-1],R=a[L.type];if(!mt(L.type)&&R==null){let[F,z]=g.range;f.push(we("Cannot make an indirect call without a valid function type",`${L.value} has type ${String(L.type)} which is not defined. Indirect calls must have pre-defined types.`,{start:F,end:z},e,b))}}})(p)}})(s);let y=f.length;if(y>0){let p=f.reduce((v,b)=>v+`
${b}
`,`Cannot generate WebAssembly for ${e}. ${y} problems.
`);throw new Error(p)}}let ue=(s,e)=>(Array.isArray(e)?s=[...s,...e]:s.push(e),s),Qo=(s,e)=>{let n=s.params.map(fe(e)).reduce(ue,[]),a=s.meta[$e];return n.push({kind:k.Call,params:[a],debug:`${s.value}<${s.type?s.type:"void"}>`}),n},Ko=(s,e)=>{let n=s.params.map(fe(e)).reduce(ue,[]),a=s.meta[Ct],c=s.meta[ft];return I(a!=null,"Undefined local index, not a valid function pointer"),I(c!=null,"Variable is not of a valid function pointer type"),[...n,{kind:k.CallIndirect,params:[c,0]}]},Ho=(s,e)=>{let n=s.params.map(fe(e)).reduce(ue,[]);return n.push({kind:ur(P({},s,{type:s.type})),params:[]}),n},Xo=(s,e)=>{let n=s.params.map(fe(e)).reduce(ue,[]);return n.push({kind:k.Select,params:[]}),n},Zo=(s,e)=>{let n=fe(e),[a,c,...l]=s.params;return[...[a].map(n).reduce(ue,[]),{kind:k.If,params:[64]},...[c].map(n).reduce(ue,[]),...l.map(n).reduce(ue,[]),{kind:k.End,params:[]}]},ea=s=>[{kind:k.i32Const,params:[Number(s.value)]}],ta=s=>{let e=s.params.filter(Boolean).map(fe(null)).reduce(ue,[]);return e.push({kind:k.Return,params:[]}),e},na=(s,e)=>[s].map(fe(e)).reduce(ue,[]),ra=(s,e)=>{let n=s.params[0];if(n){let a=s.meta[Ct],c=mt(s.type)?s.type:pt;return[...na(P({},n,{type:c}),e),{kind:k.SetLocal,params:[a],debug:`${s.value}<${String(s.type)}>`}]}return[]},sa=s=>{let[e,n]=s.params,a=[n].map(fe(null)).reduce(ue,[]);return a.push(Wo(e)),a},oa=s=>{let[e,n]=s.params,a=[n].map(fe(null)).reduce(ue,[]);return a.push({kind:k.TeeLocal,params:[Number(e.meta.LOCAL_INDEX)],debug:`${e.value}<${String(e.meta.ALIAS||e.type)}>`}),a},aa=(s,e)=>{let n=[],a=fe(e),[c,l,...f]=s.params;return n.push.apply(n,[c].map(a).reduce(ue,[])),n.push({kind:k.Block,params:[64]}),n.push({kind:k.Loop,params:[64]}),n.push.apply(n,[l].map(a).reduce(ue,[])),n.push({kind:k.i32Eqz,params:[]}),n.push({kind:k.BrIf,params:[1]}),n.push.apply(n,f.map(a).reduce(ue,[])),n.push({kind:k.Br,params:[0]}),n.push({kind:k.End,params:[]}),n.push({kind:k.End,params:[]}),n},ia=(s,e)=>{let n=s.meta[tn];I(n,`Cannot generate typecast for node: ${JSON.stringify(s)}`);let{to:a,from:c}=n;return[...s.params.map(fe(e)).reduce(ue,[]),{kind:lr(a,c),params:[]}]},ca=()=>[{kind:k.Br,params:[2]}];function la(){return[]}let ua=(s,e)=>s.params.map(fe(e)).reduce(ue,[]),pa=(s,e)=>[{kind:k.Else,params:[]},...s.params.map(fe(e)).reduce(ue,[])],fa=(s,e)=>{let[n,a]=s.params,c={kind:k.Select,params:[]},l=[n].map(fe(e)).reduce(ue,[]);return s.value==="&&"?[...[a].map(fe(e)).reduce(ue,[]),{kind:k.i32Const,params:[0]},...l,c]:[...l,...[a].map(fe(e)).reduce(ue,[]),...l,c]},vr={load8_s:0,load8_u:0,store8:0,load16_s:1,load16_u:1,store16:1,store32:2,load32_s:2,load32_u:2,store:2,load:2},ma={grow_memory:0,current_memory:0},ya=(s,e)=>{let n=s.params.map(fe(e)).reduce(ue,[]),a=s.value.split(".").pop();if(vr[a]==null)n.push({kind:un[s.value],params:[ma[s.value]]});else{let c=vr[a];n.push({kind:un[s.value],params:[c,0]})}return n},ha=s=>{let e=k[String(s.type)+"Const"],n=(s.meta.SIGN||1)*Number(s.value);return[{kind:e,params:[n]}]},da={[d.FunctionCall]:Qo,[d.IndirectFunctionCall]:Ko,[d.Constant]:ha,[d.BinaryExpression]:Ho,[d.TernaryExpression]:Xo,[d.IfThenElse]:Zo,[d.Else]:pa,[d.Select]:fa,[d.Block]:ua,[d.Identifier]:gr,[d.FunctionIdentifier]:gr,[d.FunctionPointer]:ea,[d.ReturnStatement]:ta,[d.Declaration]:ra,[d.Assignment]:sa,[d.AssignmentExpression]:oa,[d.Loop]:aa,[d.Break]:ca,[d.TypeCast]:ia,[d.Noop]:la,[d.NativeMethod]:ya},fe=wt((s,e)=>{let n=da[e.Type];return I(n,`Unsupported Syntax Token. ${e.Type} "${e.value}"`),n(e,s)}),ba=s=>({functionIndex:s}),mn=0,Gt=1,Yt=2,yt=3,_a={Memory:Yt,Table:Gt};function ga(s){let e=s.meta[$e],n=s.meta[Le];if(n!=null){let a=_a[String(s.type)]||yt;return{index:[Yt,Gt].includes(a)?0:n,kind:a,field:s.value}}return{index:e,kind:mn,field:s.value}}let va=s=>{let e={max:0,initial:0};return j({[d.Pair]:({params:n})=>{let[{value:a},{value:c}]=n;e[a]=parseInt(c)}})(s),e};function Sa(s){let e={max:0,initial:0,type:"element"};return j({[d.Pair]:({params:n})=>{let[{value:a},{value:c}]=n;switch(a){case"initial":e.initial=parseInt(c);break;case"element":e.type=c;break;case"max":e.max=parseInt(c);break}}})(s),e}let Ta=s=>{let e=_r(s),[n]=s.params;if(n!=null){let{value:a}=n;switch(e.type){case Xe:case Ze:e.init=parseFloat(a);break;case Ke:case He:default:e.init=parseInt(a)}}return e},Ea=s=>{switch(s){case"Memory":return Yt;case"Table":return Gt;case"i32":case"f32":case"i64":case"f64":return yt;default:return mn}},xa=s=>{let e=s.value;return s.meta.AS!=null?s.meta.AS:e};function Aa(s){let[e,n]=s.params,{value:a}=n,c=[];return j({[d.Pair]:(l,f)=>{let[y,p]=l.params,v=xa(y),{value:b}=p,g=Ea(b),w=(()=>{let R=p.meta[ft];return R||null})(),L=b==="Memory"?pn(p):{};c.push(P({module:a,field:v,global:g===yt,kind:g,type:Yo[b],typeIndex:w},L))}})(e),c}let et=s=>{switch(s){case"f32":return Xe;case"f64":return Ze;case"i64":return He;case"i32":case"Function":default:return Ke}},Sr=s=>{let[e]=s.params,n=s.type?et(s.type):null,a=[];return j({[d.Pair]:c=>{let l=c.params[1];I(l,"Undefined type in a argument expression"),a.push(et(l.value))}})(e),{params:a,result:n,id:s.value}};function wa(s){let e=s.value;I(typeof e=="string",`Generator: A type must have a valid string identifier, node: ${JSON.stringify(s)}`);let[n,a]=s.params,c=[];return j({[d.DeclType]:(l,f)=>{c.push(et(l.value))},[d.Type]:(l,f)=>{c.push(et(l.value))},[d.Identifier]:(l,f)=>{c.push(et(l.value))}})(n),{id:e,params:c,result:a.type&&a.type!=="void"?et(a.type):null}}function Ca(s,e){let n=e,a={},c=Object.entries(s).reduce((f,[y,p])=>(f.push({offset:Number(n),data:p}),a[y]=n,n+=p.size,f),[]),l=new le;return l.push(an,n,String(n)),{data:[{offset:0,data:l},...c],map:a}}let Oa=4,$a=s=>{let[e,n,...a]=s.params,c=s.meta[rn];I(a,"Cannot generate code for function without body"),I(c,"Cannot generate code for function without metadata");let{locals:l,argumentsCount:f}=c,y={code:[],locals:Object.keys(l).slice(f).map(p=>_r(l[p])),debug:`Function ${s.value}`};return y.code=a.map(fe(y)).reduce(ue,[]),y};function yn(s,e){let n={Version:e.version,Types:[],Start:[],Element:[],Code:[],Exports:[],Imports:[],Globals:[],Functions:[],Memory:[],Table:[],Artifacts:[],Data:[],Name:{module:e.filename,functions:[],locals:[]}},{statics:a}=s.meta[nn];e.linker!=null&&(a=P({},e.linker.statics,a));let{map:c,data:l}=Ca(a,Oa);Object.keys(a).length>0&&(n.Data=l);let f=g=>{let w=Sr(g);return n.Types.findIndex(L=>{let R=L.params.length===w.params.length&&L.params.reduce((z,X,Q)=>z&&X===w.params[Q],!0),F=L.result===w.result;return R&&F})},y=g=>n.Element.findIndex(w=>w.functionIndex===g),p={},v=N({[d.Typedef]:(g,w)=>{let L=n.Types.findIndex(({id:F})=>F===g.value),R=n.Types[L];return R==null&&(L=n.Types.length,n.Types.push(wa(g))),R=P({},g,{meta:P({},g.meta,{[ft]:L})}),p[g.value]={typeIndex:L,typeNode:R},R}})(N({[d.Import]:(g,w)=>g,[d.StringLiteral]:(g,w)=>{let{value:L}=g;return c[L]==null?g:P({},g,{value:String(c[L]),Type:d.Constant})},[d.StaticValueList]:g=>{let{value:w}=g;return P({},g,{value:String(c[w]),Type:d.Constant})}})(s)),b={[d.Typedef]:(g,w)=>g,[d.Export]:g=>{let[w]=g.params;n.Exports.push(ga(w))},[d.ImmutableDeclaration]:g=>{switch(g.type){case"Memory":n.Memory.push(va(g));break;case"Table":n.Table.push(Sa(g));break}},[d.Declaration]:g=>{g.meta[Le]!=null&&n.Globals.push(Ta(g))},[d.Import]:g=>{n.Imports.push(...Aa(g))},[d.FunctionDeclaration]:g=>{let w=(()=>{let F=f(g);return F===-1?(n.Types.push(Sr(g)),n.Types.length-1):F})(),L=N({FunctionPointer(F){let X=F.meta[$e],Q=y(X);return Q<0&&(Q=n.Element.length,n.Element.push(ba(X))),F}})(g),R=g.meta[$e];if(I(R!=null,"Function index must be set"),n.Functions[R]=w,n.Code[R]=$a(L),L.value==="start"&&n.Start.push(R),e.encodeNames){n.Name.functions.push({index:R,name:g.value});let F=g.meta[rn];F!=null&&Object.keys(F.locals).length&&(n.Name.locals[R]={index:R,locals:Object.entries(F.locals).map(([z,X])=>({name:z,index:Number(X.meta["local/index"])}))})}}};return j(b)(v),n.Code=n.Code.filter(Boolean),n}let Tr=1,La=1836278016;function Pa(s){return new le().push(an,La,"\\0asm").push(an,s,`version ${s}`)}let hn="varuint7",G="varuint32",ht="varint7",tt="varint1",dn="varint32",Er="varint64";function Ue(s,e,n){s.push(G,e.length,n);for(let a=0;a<e.length;a++)s.push(ce,e.charCodeAt(a),e[a]);return s}let Ia=s=>{let e=new le().push(G,s.length,"entry count");return s.forEach(n=>{switch(Ue(e,n.module,"module"),Ue(e,n.field,"field"),n.kind){case yt:{e.push(ce,yt,"Global"),e.push(ce,n.type,jt(n.type)),e.push(ce,0,"immutable");break}case mn:{e.push(ce,n.kind,"Function"),e.push(G,n.typeIndex,"type index");break}case Gt:{e.push(ce,n.kind,"Table"),e.push(ce,pr,"function table types"),e.push(tt,0,"has max value"),e.push(G,0,"iniital table size");break}case Yt:{e.push(ce,n.kind,"Memory"),e.push(tt,!!n.max,"has no max"),e.push(G,n.initial,"initial memory size(PAGES)"),n.max&&e.push(G,n.max,"max memory size(PAGES)");break}}}),e},Na=s=>{let e=new le;return e.push(G,s.length,"count"),s.forEach(({field:n,kind:a,index:c})=>{Ue(e,n,"field"),e.push(ce,a,"Global"),e.push(G,c,"index")}),e},Ra=(s,{type:e,init:n,mutable:a})=>{switch(s.push(ce,e,jt(e)),s.push(ce,a,"mutable"),e){case Ke:s.push(ce,k.i32Const.code,k.i32Const.text),s.push(dn,n,`value (${n})`);break;case Xe:s.push(ce,k.f32Const.code,k.f32Const.text),s.push(C,n,`value (${n})`);break;case Ze:s.push(ce,k.f64Const.code,k.f64Const.text),s.push(oe,n,`value (${n})`);break;case He:s.push(ce,k.i64Const.code,k.i64Const.text),s.push(Er,n,`value (${n})`)}s.push(ce,k.End.code,"end")},Ba=s=>{let e=new le;return e.push(G,s.length,"count"),s.forEach(n=>Ra(e,n)),e},ka=s=>{s=s.filter(n=>n!==null);let e=new le;return e.push(G,s.length,"count"),s.forEach(n=>e.push(G,n,"type index")),e};function Ma(s){let e=new le;return e.push(G,s[0],"start function"),e}let Fa=s=>({functionIndex:e},n)=>{s.push(G,0,"table index"),s.push(ce,k.i32Const.code,"offset"),s.push(G,n,n.toString()),s.push(ce,k.End.code,"end"),s.push(G,1,"number of elements"),s.push(G,e,"function index")},Da=s=>{let e=new le;return e.push(G,s.length,"count"),s.forEach(Fa(e)),e},Ua=(s,{params:e,result:n},a)=>{s.push(ht,fr,`func type (${a})`),s.push(G,e.length,"parameter count"),e.forEach(c=>s.push(ht,c,"param")),n?(s.push(tt,1,"result count"),s.push(ht,n,`result type ${jt(n)}`)):s.push(tt,0,"result count")},ja=s=>{let e=new le;return e.push(G,s.length,"count"),s.forEach((n,a)=>Ua(e,n,a)),e},za=(s,e)=>{s.push(G,1,"number of locals of following type"),s.push(ht,e.type,`${jt(e.type)}`)},Ga=(s,{locals:e,code:n,debug:a})=>{let c=new le;n.forEach(({kind:f,params:y,debug:p})=>{I(typeof f<"u",`Fatal error! Generated undefined opcode. debug code: ${JSON.stringify(p)}`),c.push(ce,f.code,`${f.text}  ${p||""}`),y.filter(v=>typeof v<"u").forEach(v=>{let b=G,g="i32.literal";if(f.code>=40&&f.code<=64)b=G,g="memory_immediate";else switch(f.result){case oe:b=oe,g="f64.literal";break;case C:b=C,g="f32.literal";break;case T:b=dn,g="i32.literal";break;case $:b=Er,g="i64.literal";break;default:b=G}c.push(b,v,`${g}`)})});let l=new le;e.forEach(f=>za(l,f)),s.push(G,c.size+l.size+2,a),s.push(G,e.length,"locals count"),s.write(l),s.write(c),s.push(ce,k.End.code,"end")},Ya=s=>{let e=new le;return e.push(G,s.length,"function count"),s.forEach(n=>Ga(e,n)),e},qa=(s,e)=>{s.push(tt,e.max?1:0,"has no max"),s.push(G,e.initial,"initial memory size(PAGES)"),e.max&&s.push(G,e.max,"max memory size(PAGES)")},Ja=s=>{let e=new le;return e.push(G,s.length,"count"),s.forEach(n=>qa(e,n)),e},Va={anyfunc:112},Wa=(s,e)=>{s.push(ht,Va[e.type],e.type),s.push(tt,e.max?1:0,"has max"),s.push(G,e.initial,"initial table size"),e.max&&s.push(G,e.max,"max table size")};function Qa(s){let e=new le;return e.push(G,s.length,"count"),s.forEach(n=>Wa(e,n)),e}let Ka=(s,e)=>{s.push(G,0,"memory index");let{offset:n,data:a}=e;s.push(ce,k.i32Const.code,k.i32Const.text),s.push(dn,n,`segment offset (${n})`),s.push(ce,k.End.code,"end"),s.push(G,a.size,"segment size"),s.write(a)};function Ha(s){let e=new le;e.push(G,s.length,"entries");for(let n=0,a=s.length;n<a;n++){let c=s[n];Ka(e,c)}return e}let Xa=s=>{let e=new le;return Ue(e,s,`name_len: ${s}`),e},Za=s=>{let e=new le;return e.push(G,s.length,`count: ${String(s.length)}`),s.forEach(({index:n,name:a})=>{e.push(G,n,`index: ${String(n)}`),Ue(e,a,`name_len: ${a}`)}),e},ei=s=>{let e=new le;return e.push(G,s.length,`count: ${String(s.length)}`),s.forEach(({index:n,locals:a})=>{e.push(G,n,`function index: ${String(n)}`),e.push(G,a.length,`number of params and locals ${a.length}`),a.forEach(({index:c,name:l})=>{e.push(G,c,`index: ${String(c)}`),Ue(e,l,`name_len: ${l}`)})}),e},ti=s=>{let e=new le;Ue(e,"name","name_len: name");let n=Xa(s.module);e.push(hn,0,"name_type: Module"),e.push(G,n.size,"name_payload_len"),e.write(n);let a=Za(s.functions);e.push(hn,1,"name_type: Function"),e.push(G,a.size,"name_payload_len"),e.write(a);let c=ei(s.locals);return e.push(hn,2,"name_type: Locals"),e.push(G,c.size,"name_payload_len"),e.write(c),e},ni=1,ri=2,si=3,oi=4,ai=5,ii=6,ci=7,li=8,ui=9,pi=10,fi=11,mi=0,Te=({type:s,label:e,emitter:n})=>a=>{let c=a[e];if(!c||Array.isArray(c)&&!c.length)return null;let l=new le().push(ce,s,e+" section"),f=n(c);return l.push(G,f.size,"size"),l.write(f),l};var Ee={type:Te({type:ni,label:"Types",emitter:ja}),imports:Te({type:ri,label:"Imports",emitter:Ia}),function:Te({type:si,label:"Functions",emitter:ka}),table:Te({type:oi,label:"Table",emitter:Qa}),memory:Te({type:ai,label:"Memory",emitter:Ja}),exports:Te({type:ci,label:"Exports",emitter:Na}),globals:Te({type:ii,label:"Globals",emitter:Ba}),start:Te({type:li,label:"Start",emitter:Ma}),element:Te({type:ui,label:"Element",emitter:Da}),code:Te({type:pi,label:"Code",emitter:Ya}),data:Te({type:fi,label:"Data",emitter:Ha}),name:Te({type:mi,label:"Name",emitter:ti})};function bn(s,e){let a=new le().write(Pa(s.Version)).write(Ee.type(s)).write(Ee.imports(s)).write(Ee.function(s)).write(Ee.table(s)).write(Ee.memory(s)).write(Ee.globals(s)).write(Ee.exports(s)).write(Ee.start(s)).write(Ee.element(s)).write(Ee.code(s)).write(Ee.data(s));return e.encodeNames?a.write(Ee.name(s)):a}let yi=(s,e=0,n)=>{let a=0;return s.data.slice(e,n).map(({type:c,value:l,debug:f})=>{let y=`${a.toString()} 0x${a.toString(16)}`.padStart(6," ").padEnd(s.data.length.toString().length+1),p;Array.isArray(l)?p=l.map(b=>b.toString(16)).join().padStart(16):p=l.toString(16).padStart(16);let v=`${y}: ${p} ; ${f}`;return a+=cn[c]||l.length,v}).join(`
`)+`
 ============ fin =============`},_n=s=>{let e=n=>{try{return s(`function fragment() {
        ${n}
      }`).params[0].params[2].params[0]}catch(a){throw new Error(`PANIC - Invalid fragment input:

${n}

Parse Error: ${a.stack}`)}};return(n,...a)=>{let c=!1,l=n.reduce((y,p,v)=>{let b=a[v];return b!=null&&typeof b!="object"?y+=p+String(b):b!=null?(c=!0,y+=p+`$$rep_${v}`):y+=p},""),f=e(l);return c?N({Identifier(y){let{value:p}=y;return p.indexOf("$$rep_")?y:a[Number(p.replace("$$rep_",""))]}})(f):f}},hi="0.21.0",di=(s,e)=>{let{version:n=Tr,encodeNames:a=!1,lines:c=s.split(`
`),filename:l="unknown",extensions:f=[]}=e||{},y=en([]),p=_n(y),v={version:n,encodeNames:a,lines:c,filename:l,extensions:f},b=y(s),g=ln(b,[],P({},v,{parser:y,stmt:p}));fn(g,{lines:c,filename:l});let w=yn(g,v);return bn(w,{version:n,encodeNames:a,filename:l,lines:c})},bi=(s,e)=>{let{filename:n="unknown.walt",extensions:a=[],linker:c,encodeNames:l=!1}=e||{},f={filename:n,lines:s.split(`
`),version:Tr,encodeNames:l},y=a.reduce((R,F)=>{let z=P({semantics:X=>({}),grammar:()=>({ParserRules:[]})},F(f));return R.grammar.push(z.grammar),R.semantics.push(z.semantics),R},{grammar:[],semantics:[]}),p=en(y.grammar),v=_n(p),b=p(s),g=ln(b,y.semantics,{parser:p,stmt:v});fn(g,f);let w=yn(g,P({},f,{linker:c})),L=bn(w,f);return{wasm:L,buffer(){return L.buffer()},ast:b,semanticAST:g}};return r.makeParser=en,r.makeFragment=_n,r.semantics=ln,r.validate=fn,r.generator=yn,r.emitter=bn,r.prettyPrintNode=dr,r.debug=yi,r.stringEncoder=cr,r.stringDecoder=Oo,r.walkNode=j,r.mapNode=N,r.VERSION=hi,r.getIR=di,r.compile=bi,r}({}),fs=ec;var tc=r=>r.trim().length?JSON.stringify([...new Uint8Array(fs.compile(r).buffer())]):"[]",nc=r=>{let t={};return Object.getOwnPropertyNames(Object.getPrototypeOf(r)).filter(o=>!["constructor","initial_state","initial_component","__walt","css","init"].includes(o)).map(o=>t[o]=r[o].bind(r)),t},rc=(r,t)=>{if(r.length){let o=new WebAssembly.Table({initial:10,element:"anyfunc"}),i=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array(r).buffer),{tag:nc(t),console,javascript:{table:o,setTimeout:(m,h)=>window.setTimeout(o.get(m),h),setInterval}}).exports,u={};return Object.keys(i).map(m=>u[m]=i[m]),u}return{}},ms={name:"Walt",uniqueBlock:"walt",compileWalt:tc,initWalt:rc};function sc(r){function t(m,h,_){var E;return _<0?_+=1:_>1&&(_-=1),6*_<1?E=m+(h-m)*_*6:2*_<1?E=h:3*_<2?E=m+(h-m)*(2/3-_)*6:E=m,255*E}function o(m,h,_){var E,A,N,M,j,te,I=Math;return h/=100,_/=100,h?(_<=.5?A=_*(h+1):A=_+h-_*h,E=_*2-A,N=m/360,M=I.ceil(t(E,A,N+1/3)),j=I.ceil(t(E,A,N)),te=I.ceil(t(E,A,N-1/3))):M=j=te=_*255,{r:M,g:j,b:te}}function i(m,h,_){return"#"+((1<<24)+(1*m<<16)+(1*h<<8)+1*_).toString(16).slice(1)}var u="|_|";return String(r).replace(/(:not\(.*?\))\s+(?!{)/g,"$1"+u).replace(/\/\*[\s\S]*?\*\//g," ").replace(/\s+/g," ").replace(/^\s+/g,"").replace(/ \{/g,"{").replace(/\;\}/g,"}").replace(/ ([+~>]) /g,"$1").replace(/([\: ,\(\)\\/])(\-*0+)(%|px|pt|pc|rem|em|ex|cm|mm|in)([, ;\(\)}\/]*?)/g,"$10$4").replace(/([: ,=\-\(\{\}])0+\.(\d)/g,"$1.$2").replace(/([^\}]*\{\s*?\})/g,"").replace(/(\*)([.:\[])/g,"$2").replace(/(\[)([^"' \]]+)(["'])([^"' \]]+)(\3)(\])/g,"$1$2$4$6").replace(/(?:{)([^{}]+?)(?:})/g,function(m,h){var _=[],E=[];h=h.replace(/(url\s*\([^)]*\))/g,function(N){return _.push(N),"$"+(_.length-1)+"$"}),h=h.match(/([a-z\-]+)\:(.+?)(;|$)/gi);for(var A=0;A<h.length;A++)h[A]=/([a-z\-]+)\:(.+?)(;|$)/i.exec(h[A]),h[A]&&(h[A][2]=h[A][2].replace(/\$([0-9]+)\$/g,function(N,M){return _[M]||""}));m={};for(var A=0;A<h.length;A++)if(h[A]){if(h[A][1]=="background"||h[A][1]=="background-image"){E.push(h[A][1]+":"+h[A][2]);continue}m[h[A][1]]=h[A][2]}for(var A in m)E.push(A+":"+m[A]);return"{"+E.join(";")+"}"}).replace(/ (\!important)/g,"$1").replace(/\:(\:before|\:after)/g,"$1").replace(/(rgb|rgba|hsl|hsla)\s*\(\s*(\d+)[, %]+(\d+)[, %]+(\d+)[, %]+?([0-1]?)\s*\)/g,function(m,h,_,E,A,N){if(N==="0")return" transparent ";if(h=h.toLowerCase(),!h.indexOf("hsl")){var M=o(_,E,A);_=M.r,E=M.g,A=M.b}return i(_,E,A)}).replace(/([,: \(]#)([0-9a-f])\2([0-9a-f])\3([0-9a-f])\4/gi,"$1$2$3$4").replace(/ ?([\(\)\{\}\:\;\,]) /g,"$1").replace(/(margin|padding|border-width|border-color|border-style)\:([^;}]+)/gi,function(m,h,_){function E(){for(var M=arguments,j=M.length>1?M:M.length==1?M[0]:[],te=0;te<j.length;te++)if(te!=0&&j[te]!=j[te-1])return!1;return!0}var A=_.toLowerCase().split(" "),N=_;return E(A)?N=A[0]:A.length==4&&E(A[0],A[2])&&E(A[1],A[3])||A.length==3&&E(A[0],A[2])?N=A[0]+" "+A[1]:A.length==4&&E(A[1],A[3])&&(N=A[0]+" "+A[1]+" "+A[2]),N=h+":"+N,N}).replace(/\:\s*calc\(([^;}]+)/g,function(m){return m.replace(/\s+/g,"").replace(/([-+*/]+)/g," $1 ").replace(/(--)\s/g,"$1")}).replace(/\|_\|/g," ")}var ys=sc;var hs={name:"min.css",processStyle:ys};var oc={walt:ms,mincss:hs},Et=oc;var lt;if(typeof window<"u"){class r extends HTMLElement{constructor(){super(),this.ShadowDOM="open",this.state=this.initial_state,this.__walt&&(this.walt=Et.walt.initWalt(this.__walt,this,this.state)),this.init&&this.init(),this.document=["open","closed"].includes(this.ShadowDOM)?this.attachShadow({mode:this.ShadowDOM}):this,this.initialize()}attributeChangedCallback(o,i,u){this.setAttribute(o,u)}}Ht(r,ct),lt=r}var xt=class{constructor(){if(this.state=this.initial_state,this.init&&this.init(),this.document=document.querySelector(this.container),!this.document)throw`i.js: target container "${this.container}" not found`;this.initialize(),this.connectedCallback()}destroy(){this.disconnectedCallback()}};Ht(xt,ct);var ds=(r,t=0)=>{for(var o=3735928559^t,i=1103547991^t,u=0,m;u<r.length;u++)m=r.charCodeAt(u),o=Math.imul(o^m,2654435761),i=Math.imul(i^m,1597334677);return o=Math.imul(o^o>>>16,2246822507)^Math.imul(i^i>>>13,3266489909),i=Math.imul(i^i>>>16,2246822507)^Math.imul(o^o>>>13,3266489909),4294967296*(2097151&i)+(o>>>0)};function At(r,t){return"i-"+String(ds(t||r.trim())).replaceAll("-","i")}var ac={},qe=ac;var Gn={},bs=Object.getPrototypeOf(async function(){}).constructor,ic=r=>r.split("-").map(t=>t.slice(0,1).toUpperCase()+t.slice(1)).join(""),cc=r=>((t,o)=>JSON.stringify(r,(i,u)=>typeof u=="function"?o.push(u)&&t:u).replace(new RegExp('"'+t+'"',"g"),i=>o.shift()))("____"+qr(50)+"____",[]),lc=(r,t)=>{if(Gn[r])return Gn[r];let o=URL.createObjectURL(new Blob([String.raw({raw:t})],{type:"text/javascript"}));return Gn[r]=o,o},uc=(r,t)=>r.reduce((o,i)=>{let u=t?"i.js:"+t+i.path:lc(i.path,i.src);return i.type==="*"?o+"const "+i.import+" = {...(await import(`"+u+"`))};\n":i.type==="object"?o+"const "+i.import+" =  (await import(`"+u+"`));\n":o+"const "+i.import+" =  (await import(`"+u+"`)).default;\n"},"");function _s(r,t,{inFunc:o=!1}){let i=Object.values(Et).filter(j=>j.processStyle).reduce((j,te)=>te.processStyle(j),r.style||""),u=r.walt?Et.walt.compileWalt(r.walt):"undefined",m=`{${(r.state||"").trim()}}`,h=t!=="customElement"?"":new Function(`return 'static get observedAttributes() { return '+JSON.stringify(Object.keys(${m}))+' }'`)(),_=ic(r.name),E=cc(us(r.template,r.tag||[])),A=r.container?`get container()         { return "${r.container}" }`:"",N=`
        ${r.import?uc(r.import,r.nodePath):""}
        ${r.static||""};
        class ${_} extends ${t} {
            ${h}
            get initial_state()     { return ${m} }
            get initial_component() { return ${E} }
            get css()               { return \`${i}\`; }
            get __walt()            { return ${u} }
            ${A}
            ${r.class||""}
        };
    `,M=t==="customElement"?`
        if(!customElements.get('${r.name}')) {
            ${N}
            customElements.define('${r.name}', ${_});
            window['iJS'].tags['${r.name}'] = true;
        }
    `:`${N} return new ${_}()`;return o?`;(async () => {${M}})();`:M}async function vs(r,t){let o=At(r.innerText);await Je(r.innerText,{name:o,path:t}),r.replaceWith(document.createElement(o))}async function qn(r,t,o){await Je(r,{name:t,path:o})}async function Jn(r,t,o=""){if(qe[r])return!0;let i=t.substr(-4)===".tag"?t:t+".tag",u=t[0]!=="/"?Yn(o+i):i,m=await fetch(u).catch(_=>!1);if(m===!1)throw"i.js  \u2764\uFE0F error loading "+i;let h=u.substring(0,u.lastIndexOf("/"))+"/";await qn(await m.text(),r,h)}async function Ss(r,t,o){await Je(r.innerText,{name:At(r.innerText),path:o,container:t})}function Yn(r){return typeof window>"u"?r:new URL(r,document.baseURI).pathname}async function Xt({source:r,path:t,keepName:o,nodeFetch:i,nodePath:u}){let m=o?t.split("/").pop().split(".")[0]:At(t);return{name:m,compiled:await Je(r,{name:m,path:t.substring(0,t.lastIndexOf("/"))+"/",bundle:!0,nodeFetch:i,nodePath:u})}}async function gs(r,t){if(t)return await t(r);let o=await fetch(r).catch(i=>!1);if(o===!1)throw"i.js  \u2764\uFE0F error loading "+r;return(await o.text()).trim()}async function Je(r,t={}){let o=await ps(r);if(!t.name)throw"name is undefined !!!";o.name=t.name||"i-component",o.path=t.path,o.container=t.container||"",o.nodePath=t.nodePath?t.nodePath+t.path:void 0;let i=t.nodeFetch||void 0;var u="";if(o.style&&(o.style=o.style.trim(),o.style.length&&(u=o.style)),o.css)for(let m of o.css){let h=m[0]!=="/"?Yn(o.path+m):m,_=await gs(h,i);_.length&&(u+=`
`+_)}if(o.style=u.replaceAll("`","`").trim(),o.tag)for(let m of o.tag){let h=m.path,_=At(h.substr(-4)===".tag"?h:h+".tag");m.name=_,i?m.src=await i(h.substr(-4)===".tag"?h:h+".tag"):await Jn(_,h,o.path)}if(o.import&&!i)for(let m of o.import){let h=m.path[0]!=="/"?Yn(o.path+m.path):m.path,_=await gs(h,i);m.src=_}if(qe[o.name]=!0,o.container){let m=_s(o,"iElement",{inFunc:!1});return await new bs("iElement",m)(xt)}else{let m=_s(o,"customElement",{inFunc:!0});if(t.bundle){if(o.tag){let h="";for(let _ of o.tag)if(qe[_.name])console.log(`              <${_.name}> skipped`);else{let{name:E,compiled:A}=await Xt({source:_.src,path:_.path.substr(-4)===".tag"?_.path:_.path+".tag",name:_.name,nodePath:o.nodePath,nodeFetch:i});h+=A}return h+m}return m}await new bs("customElement",m)(lt)}}function pc(r,t){r.innerText.trim().length&&console.warn(`i.js \u2764\uFE0F  warning: contents of "<script type=i ${t.map(o=>o.name).join(" ")}> will be ignored"`)}function Ts(r,t){r.innerText.trim().length||console.warn(`i.js \u2764\uFE0F  warning: empty "<script type=i ${t.map(o=>o.name).join(" ")}>"`)}async function Es(){let r=Array.from(document.querySelectorAll('script[type="i"]'));try{for(let t of r){let o=window.location.pathname,i=o.substring(0,o.lastIndexOf("/"))+"/",u=Array.prototype.slice.call(t.attributes).map(_=>({name:_.name,value:t.getAttribute(_.name).trim()})),m=u.find(_=>_.name==="target"&&_.value.length);if(m){u.length>2&&console.warn(`i.js \u2764\uFE0F  warning: all other attributes for "<script type=i target="${m.value}"> will be ignored"`),await Ss(t,m.value,i),t.remove();continue}let h=u.filter(_=>_.name.includes("-"));if(h.length>1)throw`i.js \u2764\uFE0F  ERROR: more then one attribute with hyphens "<script ${h.map(_=>_.name).join(" ")}>"`;h.length===1?(h[0].value?(pc(t,u),await Jn(h[0].name,h[0].value,i)):(Ts(t,u),await qn(t.innerText,h[0].name,i)),t.remove()):(Ts(t,u),await vs(t,i))}}catch(t){throw new qt(t)}}var Vn="0.5.6";console.log(`i.js \u2764\uFE0F  ${Vn} alpha experiment. Make DOM great again!`);var xs={VERSION:Vn,tags:qe,customElement:lt,createTag:Je,compile:Xt},fc=xs;typeof window<"u"&&(window.iJS=xs,document.addEventListener("DOMContentLoaded",Es));
/**
 * WASM types
 *
 * https://github.com/WebAssembly/spec/tree/master/interpreter#s-expression-syntax
 *
 * Plus some extra C type mappings
 *
 * @author arthrubuldauskas@gmail.com
 * @license MIT
 */
/**
 * min.css
 *
 * min.css is a tiny, fast and efficient JavaScript library for minifying CSS
 * files that really makes your website faster
 *
 * Site: https://github.com/w3core/min.css/
 * Online: https://w3core.github.io/min.css/
 *
 * @version 1.3.1
 *
 * @license BSD License
 * @author Max Chuhryaev
 */
